<!-- ============================================================================
     ATLAS PERFORMANCE - PREMIUM NAVBAR
     Design: Glassmorphism, Minimalist, Elegant
     Responsive: Desktop Sidebar + Mobile Top Navigation
     Features: Smooth transitions, micro-interactions, refined typography
============================================================================= -->

<style>
    /* ==================== FONT IMPORTS ==================== */
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap');

    /* ==================== CSS CUSTOM PROPERTIES ==================== */
    :root {
        --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        --glass-bg: rgba(255, 255, 255, 0.05);
        --glass-border: rgba(255, 255, 255, 0.1);
        --glass-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
        --transition-smooth: cubic-bezier(0.4, 0, 0.2, 1);
        --nav-width: 280px;
    }

    /* ==================== GLOBAL TYPOGRAPHY ==================== */
    .navbar-font {
        font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
        -webkit-font-smoothing: antialiased;
        -moz-osx-font-smoothing: grayscale;
    }

    /* ==================== KEYFRAME ANIMATIONS ==================== */
    @keyframes shimmerEffect {
        0% { background-position: -200% center; }
        100% { background-position: 200% center; }
    }

    @keyframes floatAnimation {
        0%, 100% { transform: translateY(0px); }
        50% { transform: translateY(-10px); }
    }

    @keyframes slideInFromLeft {
        from {
            opacity: 0;
            transform: translateX(-30px);
        }
        to {
            opacity: 1;
            transform: translateX(0);
        }
    }

    @keyframes pulseGlow {
        0%, 100% {
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.4);
        }
        50% {
            box-shadow: 0 0 30px rgba(102, 126, 234, 0.8);
        }
    }

    /* ==================== DESKTOP SIDEBAR ==================== */
    .premium-sidebar {
        position: fixed;
        top: 0;
        left: 0;
        height: 100vh;
        width: var(--nav-width);
        background: linear-gradient(180deg,
            rgba(17, 24, 39, 0.98) 0%,
            rgba(31, 41, 55, 0.98) 50%,
            rgba(17, 24, 39, 0.98) 100%);
        backdrop-filter: blur(20px);
        border-right: 1px solid var(--glass-border);
        box-shadow: var(--glass-shadow);
        z-index: 1000;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* ==================== LOGO SECTION - COMPACT ==================== */
    .navbar-brand {
        height: 80px;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 16px;
        background: linear-gradient(135deg,
            rgba(102, 126, 234, 0.1) 0%,
            rgba(118, 75, 162, 0.1) 100%);
        border-bottom: 1px solid var(--glass-border);
        position: relative;
        overflow: hidden;
    }

    .navbar-brand::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg,
            transparent,
            rgba(255, 255, 255, 0.1),
            transparent);
        animation: shimmerEffect 3s infinite;
    }

    .brand-logo {
        display: flex;
        align-items: center;
        gap: 12px;
        position: relative;
        z-index: 1;
    }

    .brand-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        animation: pulseGlow 3s infinite;
    }

    .brand-icon i {
        font-size: 18px !important;
        color: white !important;
        font-family: "Font Awesome 6 Free" !important;
        font-weight: 900 !important;
        opacity: 1 !important;
        visibility: visible !important;
    }

    .brand-text {
        font-size: 18px;
        font-weight: 700;
        color: white;
        letter-spacing: -0.5px;
    }

    .brand-text-accent {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
    }

    /* ==================== NAVIGATION SECTION - COMPACT ==================== */
    .nav-section {
        flex: 1;
        padding: 20px 16px;
        overflow-y: auto;
        overflow-x: hidden;
    }

    /* Custom Scrollbar */
    .nav-section::-webkit-scrollbar {
        width: 6px;
    }

    .nav-section::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.02);
    }

    .nav-section::-webkit-scrollbar-thumb {
        background: rgba(102, 126, 234, 0.3);
        border-radius: 10px;
    }

    .nav-section::-webkit-scrollbar-thumb:hover {
        background: rgba(102, 126, 234, 0.5);
    }

    /* Navigation Items */
    .nav-items-list {
        display: flex;
        flex-direction: column;
        gap: 8px;
    }

    .nav-link {
        display: flex;
        align-items: center;
        gap: 12px;
        padding: 12px 16px;
        color: rgba(255, 255, 255, 0.7);
        border-radius: 12px;
        text-decoration: none;
        transition: all 0.3s var(--transition-smooth);
        position: relative;
        overflow: hidden;
        font-weight: 500;
        font-size: 14px;
        letter-spacing: 0.2px;
    }

    /* Glassmorphism hover effect */
    .nav-link::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg,
            transparent,
            rgba(102, 126, 234, 0.15),
            transparent);
        transition: left 0.5s var(--transition-smooth);
    }

    .nav-link:hover::before {
        left: 100%;
    }

    .nav-link:hover {
        background: rgba(102, 126, 234, 0.12);
        color: white;
        transform: translateX(8px);
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
    }

    /* Active state */
    .nav-link.active {
        background: linear-gradient(135deg,
            rgba(102, 126, 234, 0.2) 0%,
            rgba(118, 75, 162, 0.2) 100%);
        color: white;
        box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);
        border: 1px solid rgba(102, 126, 234, 0.3);
    }

    .nav-link.active::after {
        content: '';
        position: absolute;
        left: 0;
        top: 50%;
        transform: translateY(-50%);
        width: 4px;
        height: 70%;
        background: linear-gradient(180deg, #667eea 0%, #764ba2 100%);
        border-radius: 0 4px 4px 0;
    }

    /* Icon styling */
    .nav-icon {
        width: 24px;
        height: 24px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 18px;
        transition: transform 0.3s var(--transition-smooth);
    }

    .nav-icon i {
        font-family: "Font Awesome 6 Free" !important;
        font-weight: 900 !important;
        font-style: normal !important;
        display: inline-block !important;
        opacity: 1 !important;
        visibility: visible !important;
        line-height: 1 !important;
    }

    .nav-icon i::before {
        font-family: "Font Awesome 6 Free" !important;
        font-weight: 900 !important;
        opacity: 1 !important;
        visibility: visible !important;
        display: inline-block !important;
    }

    .nav-link:hover .nav-icon {
        transform: scale(1.15) rotate(-5deg);
    }

    .nav-link.active .nav-icon {
        color: #667eea;
    }

    /* ==================== USER PROFILE SECTION - COMPACT ==================== */
    .user-section {
        padding: 14px;
        border-top: 1px solid var(--glass-border);
        background: linear-gradient(135deg,
            rgba(102, 126, 234, 0.05) 0%,
            rgba(118, 75, 162, 0.05) 100%);
        box-sizing: border-box;
        width: 100%;
        max-width: var(--nav-width);
        overflow: hidden;
    }

    .user-profile-card {
        display: flex;
        align-items: center;
        gap: 10px;
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 12px;
        margin-bottom: 10px;
        transition: all 0.3s var(--transition-smooth);
        cursor: pointer;
        text-decoration: none !important;
        border: 1px solid transparent;
        max-width: 100%;
        overflow: hidden;
    }

    .user-profile-card:hover {
        background: rgba(255, 255, 255, 0.08);
        border: 1px solid rgba(102, 126, 234, 0.3);
        transform: translateY(-2px);
    }

    .user-profile-card:active,
    .user-profile-card:visited,
    .user-profile-card:focus {
        text-decoration: none !important;
    }

    .user-avatar {
        width: 38px;
        height: 38px;
        min-width: 38px;
        min-height: 38px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 700;
        font-size: 14px !important;
        box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        transition: transform 0.3s var(--transition-smooth);
        flex-shrink: 0;
    }

    .user-profile-card:hover .user-avatar {
        transform: scale(1.1) rotate(5deg);
    }

    .user-info {
        flex: 1;
        min-width: 0;
        max-width: calc(100% - 58px);
        overflow: hidden;
    }

    .user-name {
        font-weight: 600 !important;
        font-size: 13px !important;
        color: white !important;
        margin-bottom: 2px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.3;
        max-width: 100%;
    }

    .user-role {
        font-size: 11px !important;
        color: rgba(255, 255, 255, 0.5) !important;
        font-weight: 400 !important;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
        line-height: 1.3;
        max-width: 100%;
    }

    /* Logout Button - COMPACT */
    .logout-button {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
        width: 100%;
        max-width: 100%;
        padding: 10px;
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border-radius: 10px;
        border: 1px solid rgba(239, 68, 68, 0.2);
        text-decoration: none;
        font-weight: 600;
        font-size: 13px;
        transition: all 0.3s var(--transition-smooth);
        box-sizing: border-box;
        overflow: hidden;
        white-space: nowrap;
    }

    .logout-button:hover {
        background: rgba(239, 68, 68, 0.2);
        border-color: rgba(239, 68, 68, 0.4);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(239, 68, 68, 0.3);
    }

    /* ==================== MOBILE HEADER ==================== */
    .mobile-header {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        height: 70px;
        background: linear-gradient(135deg,
            rgba(17, 24, 39, 0.98) 0%,
            rgba(31, 41, 55, 0.98) 100%);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--glass-border);
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
        z-index: 1001;
        display: none;
        padding: 0 20px;
    }

    .mobile-header-content {
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: space-between;
    }

    .mobile-brand {
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .mobile-brand-icon {
        width: 40px;
        height: 40px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .mobile-brand-icon i {
        color: white !important;
        font-family: "Font Awesome 6 Free" !important;
        font-weight: 900 !important;
        opacity: 1 !important;
        visibility: visible !important;
        font-size: 18px !important;
    }

    .mobile-brand-text {
        font-size: 18px;
        font-weight: 700;
        color: white;
    }

    .mobile-controls {
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .mobile-user-avatar {
        display: none !important;
    }

    .mobile-menu-button {
        width: 40px;
        height: 40px;
        background: rgba(102, 126, 234, 0.15);
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        border: 1px solid rgba(102, 126, 234, 0.3);
        transition: all 0.3s var(--transition-smooth);
        cursor: pointer;
    }

    .mobile-menu-button:hover,
    .mobile-menu-button.active {
        background: rgba(102, 126, 234, 0.3);
        border-color: rgba(102, 126, 234, 0.5);
        transform: scale(1.05);
    }

    /* Mobile Dropdown */
    .mobile-dropdown {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        background: linear-gradient(135deg,
            rgba(17, 24, 39, 0.98) 0%,
            rgba(31, 41, 55, 0.98) 100%);
        backdrop-filter: blur(20px);
        border-bottom: 1px solid var(--glass-border);
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        max-height: calc(100vh - 70px);
        overflow-y: auto;
        transform: translateY(-100%);
        opacity: 0;
        transition: all 0.4s var(--transition-smooth);
        z-index: 1000;
    }

    .mobile-dropdown.show {
        transform: translateY(0);
        opacity: 1;
    }

    .mobile-nav-items {
        padding: 20px 16px;
        display: flex;
        flex-direction: column;
        gap: 10px;
    }

    .mobile-nav-link {
        display: flex;
        align-items: center;
        gap: 18px;
        padding: 16px 20px;
        color: rgba(255, 255, 255, 0.7);
        border-radius: 14px;
        text-decoration: none;
        transition: all 0.3s var(--transition-smooth);
        font-weight: 500;
        font-size: 16px;
        min-height: 56px;
    }

    .mobile-nav-link .nav-icon {
        width: 40px;
        min-width: 40px;
        height: 40px;
        display: flex !important;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        color: white !important;
        background: rgba(102, 126, 234, 0.2);
        border-radius: 10px;
        flex-shrink: 0;
        position: relative;
        overflow: visible !important;
        opacity: 1 !important;
        visibility: visible !important;
        z-index: 10;
        /* FIX: Garantisce che il box dell'icona sia sempre visibile */
        pointer-events: auto !important;
    }

    .mobile-nav-link .nav-icon i {
        font-size: 20px !important;
        color: white !important;
        font-family: "Font Awesome 6 Free" !important;
        font-weight: 900 !important;
        display: inline-block !important;
        font-style: normal !important;
        font-variant: normal !important;
        text-rendering: auto !important;
        -webkit-font-smoothing: antialiased !important;
        -moz-osx-font-smoothing: grayscale !important;
        line-height: 1 !important;
        opacity: 1 !important;
        visibility: visible !important;
        width: auto !important;
        height: auto !important;
        margin: 0 auto !important;
        padding: 0 !important;
        position: relative;
        z-index: 11;
        /* FIX: Previene nascondimento dell'icona */
        transform: none !important;
        clip-path: none !important;
        mask: none !important;
        -webkit-mask: none !important;
        filter: none !important;
        backdrop-filter: none !important;
    }

    .mobile-nav-link .nav-icon i::before {
        display: inline-block !important;
        font-family: "Font Awesome 6 Free" !important;
        font-weight: 900 !important;
        opacity: 1 !important;
        visibility: visible !important;
        /* FIX: Forza rendering del glyph Font Awesome */
        color: white !important;
        background: transparent !important;
        transform: none !important;
    }

    .mobile-nav-link:hover,
    .mobile-nav-link.active {
        background: rgba(102, 126, 234, 0.15);
        color: white;
        transform: translateX(4px);
    }

    .mobile-nav-link:hover .nav-icon,
    .mobile-nav-link.active .nav-icon {
        background: rgba(102, 126, 234, 0.4);
        color: white;
    }

    .mobile-nav-link.active {
        border: 1px solid rgba(102, 126, 234, 0.3);
    }

    .mobile-nav-link.active .nav-icon {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
    }

    .mobile-divider {
        height: 1px;
        background: var(--glass-border);
        margin: 16px 0;
    }

    /* Mobile Overlay */
    .mobile-overlay {
        position: fixed;
        top: 70px;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(4px);
        opacity: 0;
        pointer-events: none;
        transition: opacity 0.3s var(--transition-smooth);
        z-index: 999;
    }

    .mobile-overlay.show {
        opacity: 1;
        pointer-events: auto;
    }

    /* ==================== RESPONSIVE DESIGN ==================== */
    @media (max-width: 768px) {
        .premium-sidebar {
            display: none;
        }

        .mobile-header {
            display: block;
        }

        body {
            padding-top: 70px;
        }
    }

    @media (min-width: 769px) {
        .mobile-header,
        .mobile-dropdown,
        .mobile-overlay {
            display: none !important;
        }
    }

    /* ==================== UTILITY CLASSES ==================== */
    .stagger-animation {
        animation: slideInFromLeft 0.5s ease-out forwards;
        opacity: 0;
    }

    .stagger-animation:nth-child(1) { animation-delay: 0.05s; }
    .stagger-animation:nth-child(2) { animation-delay: 0.1s; }
    .stagger-animation:nth-child(3) { animation-delay: 0.15s; }
    .stagger-animation:nth-child(4) { animation-delay: 0.2s; }
    .stagger-animation:nth-child(5) { animation-delay: 0.25s; }
    .stagger-animation:nth-child(6) { animation-delay: 0.3s; }
    .stagger-animation:nth-child(7) { animation-delay: 0.35s; }
    .stagger-animation:nth-child(8) { animation-delay: 0.4s; }
</style>

<!-- ============================================================================
     DESKTOP SIDEBAR NAVIGATION
============================================================================= -->
<aside class="premium-sidebar navbar-font">
    <!-- Logo/Brand Section -->
    <div class="navbar-brand">
        <div class="brand-logo">
            <div class="brand-icon">
                <i class="fas fa-dumbbell" style="color: white; font-size: 22px;"></i>
            </div>
            <div>
                <div class="brand-text">
                    Atlas<span class="brand-text-accent">Performance</span>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Items Section -->
    <nav class="nav-section">
        <div class="nav-items-list">
            {% if current_user.is_super_admin() %}
                <!-- Super Admin Navigation -->
                <a href="{{ url_for('super_admin.dashboard') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'super_admin.dashboard' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-chart-pie"></i></span>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('super_admin.tenants') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'super_admin.tenants' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-building"></i></span>
                    <span>Tenants</span>
                </a>
                <a href="{{ url_for('super_admin.analytics') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'super_admin.analytics' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                    <span>Analytics</span>
                </a>

            {% elif current_user.is_trainer() %}
                <!-- Trainer Navigation -->
                <a href="{{ url_for('trainer.dashboard') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'trainer.dashboard' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-home"></i></span>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('trainer.athletes_list') }}"
                   class="nav-link stagger-animation {% if 'athletes' in request.endpoint %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-users"></i></span>
                    <span>Atleti</span>
                </a>
                <a href="{{ url_for('trainer.workouts_list') }}"
                   class="nav-link stagger-animation {% if 'workout' in request.endpoint %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-dumbbell"></i></span>
                    <span>Allenamenti</span>
                </a>
                <a href="{{ url_for('trainer.exercises_library') }}"
                   class="nav-link stagger-animation {% if 'exercise' in request.endpoint %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-book"></i></span>
                    <span>Esercizi</span>
                </a>
                <a href="{{ url_for('trainer.messages') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'trainer.messages' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-comments"></i></span>
                    <span>Messaggi</span>
                </a>

            {% elif current_user.is_athlete() %}
                <!-- Athlete Navigation -->
                <a href="{{ url_for('athlete.dashboard') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'athlete.dashboard' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-home"></i></span>
                    <span>Dashboard</span>
                </a>
                <a href="{{ url_for('athlete.progress') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'athlete.progress' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                    <span>Statistiche</span>
                </a>
                <a href="{{ url_for('athlete.check_in') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'athlete.check_in' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-calendar-check"></i></span>
                    <span>Calendario</span>
                </a>
                <a href="{{ url_for('athlete.nutrition') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'athlete.nutrition' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-apple-alt"></i></span>
                    <span>Media</span>
                </a>
                <a href="{{ url_for('athlete.messages') }}"
                   class="nav-link stagger-animation {% if request.endpoint == 'athlete.messages' %}active{% endif %}">
                    <span class="nav-icon"><i class="fas fa-comments"></i></span>
                    <span>Messaggi</span>
                </a>
            {% endif %}
        </div>
    </nav>

    <!-- User Profile Section -->
    <div class="user-section">
        <a href="{% if current_user.is_trainer() %}{{ url_for('trainer.profile') }}{% elif current_user.is_athlete() %}{{ url_for('athlete.profile') }}{% elif current_user.is_super_admin() %}{{ url_for('super_admin.profile') }}{% else %}#{% endif %}"
           class="user-profile-card">
            <div class="user-avatar">
                {{ current_user.first_name[0] }}{{ current_user.last_name[0] }}
            </div>
            <div class="user-info">
                <div class="user-name">{{ current_user.first_name }} {{ current_user.last_name }}</div>
                <div class="user-role">
                    {% if current_user.is_trainer() %}
                        Trainer
                    {% elif current_user.is_athlete() %}
                        Atleta
                    {% elif current_user.is_super_admin() %}
                        Amministratore
                    {% else %}
                        {{ current_user.role|title }}
                    {% endif %}
                </div>
            </div>
        </a>

        <a href="{{ url_for('auth.logout') }}" class="logout-button">
            <i class="fas fa-sign-out-alt"></i>
            <span>Logout</span>
        </a>
    </div>
</aside>

<!-- ============================================================================
     MOBILE NAVIGATION
============================================================================= -->
<!-- Mobile Header -->
<header class="mobile-header navbar-font">
    <div class="mobile-header-content">
        <div class="mobile-brand">
            <div class="mobile-brand-icon">
                <i class="fas fa-dumbbell" style="color: white; font-size: 18px;"></i>
            </div>
            <div class="mobile-brand-text">
                Atlas<span class="brand-text-accent">Performance</span>
            </div>
        </div>

        <div class="mobile-controls">
            <a href="{% if current_user.is_trainer() %}{{ url_for('trainer.profile') }}{% elif current_user.is_athlete() %}{{ url_for('athlete.profile') }}{% elif current_user.is_super_admin() %}{{ url_for('super_admin.profile') }}{% else %}#{% endif %}"
               class="mobile-user-avatar">
                {{ current_user.first_name[0] }}{{ current_user.last_name[0] }}
            </a>

            <button class="mobile-menu-button" id="mobileMenuBtn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars" id="menuIcon"></i>
            </button>
        </div>
    </div>
</header>

<!-- Mobile Dropdown Menu -->
<div class="mobile-dropdown navbar-font" id="mobileDropdown">
    <div class="mobile-nav-items">
        {% if current_user.is_super_admin() %}
            <!-- Super Admin Mobile Menu -->
            <a href="{{ url_for('super_admin.dashboard') }}"
               class="mobile-nav-link {% if request.endpoint == 'super_admin.dashboard' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-chart-pie"></i></span>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('super_admin.tenants') }}"
               class="mobile-nav-link {% if request.endpoint == 'super_admin.tenants' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-building"></i></span>
                <span>Tenants</span>
            </a>
            <a href="{{ url_for('super_admin.analytics') }}"
               class="mobile-nav-link {% if request.endpoint == 'super_admin.analytics' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                <span>Analytics</span>
            </a>

        {% elif current_user.is_trainer() %}
            <!-- Trainer Mobile Menu -->
            <a href="{{ url_for('trainer.dashboard') }}"
               class="mobile-nav-link {% if request.endpoint == 'trainer.dashboard' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-home"></i></span>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('trainer.athletes_list') }}"
               class="mobile-nav-link {% if 'athletes' in request.endpoint %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-users"></i></span>
                <span>Atleti</span>
            </a>
            <a href="{{ url_for('trainer.workouts_list') }}"
               class="mobile-nav-link {% if 'workout' in request.endpoint %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-dumbbell"></i></span>
                <span>Allenamenti</span>
            </a>
            <a href="{{ url_for('trainer.exercises_library') }}"
               class="mobile-nav-link {% if 'exercise' in request.endpoint %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-book"></i></span>
                <span>Esercizi</span>
            </a>
            <a href="{{ url_for('trainer.messages') }}"
               class="mobile-nav-link {% if request.endpoint == 'trainer.messages' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-comments"></i></span>
                <span>Messaggi</span>
            </a>

        {% elif current_user.is_athlete() %}
            <!-- Athlete Mobile Menu -->
            <a href="{{ url_for('athlete.dashboard') }}"
               class="mobile-nav-link {% if request.endpoint == 'athlete.dashboard' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-home"></i></span>
                <span>Dashboard</span>
            </a>
            <a href="{{ url_for('athlete.progress') }}"
               class="mobile-nav-link {% if request.endpoint == 'athlete.progress' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-chart-line"></i></span>
                <span>Statistiche</span>
            </a>
            <a href="{{ url_for('athlete.check_in') }}"
               class="mobile-nav-link {% if request.endpoint == 'athlete.check_in' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-calendar-check"></i></span>
                <span>Calendario</span>
            </a>
            <a href="{{ url_for('athlete.nutrition') }}"
               class="mobile-nav-link {% if request.endpoint == 'athlete.nutrition' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-apple-alt"></i></span>
                <span>Media</span>
            </a>
            <a href="{{ url_for('athlete.messages') }}"
               class="mobile-nav-link {% if request.endpoint == 'athlete.messages' %}active{% endif %}">
                <span class="nav-icon"><i class="fas fa-comments"></i></span>
                <span>Messaggi</span>
            </a>
        {% endif %}

        <div class="mobile-divider"></div>

        <a href="{{ url_for('auth.logout') }}" class="mobile-nav-link" style="color: #ef4444;">
            <span class="nav-icon"><i class="fas fa-sign-out-alt"></i></span>
            <span>Logout</span>
        </a>
    </div>
</div>

<!-- Mobile Overlay -->
<div class="mobile-overlay" id="mobileOverlay" onclick="toggleMobileMenu()"></div>

<!-- ============================================================================
     JAVASCRIPT FOR MOBILE MENU INTERACTIONS
============================================================================= -->
<script>
    // Toggle mobile menu
    function toggleMobileMenu() {
        const dropdown = document.getElementById('mobileDropdown');
        const overlay = document.getElementById('mobileOverlay');
        const menuBtn = document.getElementById('mobileMenuBtn');
        const menuIcon = document.getElementById('menuIcon');

        dropdown.classList.toggle('show');
        overlay.classList.toggle('show');
        menuBtn.classList.toggle('active');

        // Toggle icon
        if (dropdown.classList.contains('show')) {
            menuIcon.classList.remove('fa-bars');
            menuIcon.classList.add('fa-times');
            // FIX: NON bloccare overflow - può nascondere le icone
            // document.body.style.overflow = 'hidden';
        } else {
            menuIcon.classList.remove('fa-times');
            menuIcon.classList.add('fa-bars');
            // Restore body scroll
            document.body.style.overflow = '';
        }
    }

    // Close mobile menu when clicking on a link
    document.addEventListener('DOMContentLoaded', function() {
        // FIX: Forza rendering icone Font Awesome dopo caricamento
        function ensureFontAwesomeLoaded() {
            const icons = document.querySelectorAll('.mobile-nav-link .nav-icon i, .brand-icon i, .mobile-brand-icon i');
            icons.forEach(icon => {
                // Forza re-render
                icon.style.display = 'none';
                icon.offsetHeight; // trigger reflow
                icon.style.display = 'inline-block';

                // Debug: verifica che l'icona abbia contenuto
                const computed = window.getComputedStyle(icon, '::before');
                if (!computed.content || computed.content === 'none') {
                    console.warn('Icon missing content:', icon.className);
                }
            });
        }

        // Esegui dopo 100ms per dare tempo a Font Awesome di caricarsi
        setTimeout(ensureFontAwesomeLoaded, 100);

        // Esegui anche quando Font Awesome è completamente caricato
        if (document.fonts) {
            document.fonts.ready.then(ensureFontAwesomeLoaded);
        }

        const mobileLinks = document.querySelectorAll('.mobile-nav-link');
        mobileLinks.forEach(link => {
            link.addEventListener('click', function() {
                // Small delay to allow navigation to start
                setTimeout(() => {
                    const dropdown = document.getElementById('mobileDropdown');
                    if (dropdown && dropdown.classList.contains('show')) {
                        toggleMobileMenu();
                    }
                }, 100);
            });
        });

        // Handle window resize
        let resizeTimer;
        window.addEventListener('resize', function() {
            clearTimeout(resizeTimer);
            resizeTimer = setTimeout(function() {
                if (window.innerWidth > 768) {
                    const dropdown = document.getElementById('mobileDropdown');
                    const overlay = document.getElementById('mobileOverlay');
                    if (dropdown && dropdown.classList.contains('show')) {
                        dropdown.classList.remove('show');
                        overlay.classList.remove('show');
                        document.body.style.overflow = '';
                    }
                }
            }, 250);
        });
    });
</script>

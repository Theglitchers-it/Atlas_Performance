{#
Lazy Loading Image Component
Usage in templates:
{% include 'components/lazy_image.html' with context %}

Parameters:
- src: Image source URL (required)
- alt: Alt text (required)
- class: CSS classes
- width: Image width
- height: Image height
- sizes: Responsive sizes attribute
- loading: 'lazy' (default) or 'eager'
#}

{% set img_class = class|default('') %}
{% set img_width = width|default('') %}
{% set img_height = height|default('') %}
{% set img_loading = loading|default('lazy') %}
{% set img_sizes = sizes|default('100vw') %}

{# Check if WebP version exists #}
{% set base_url = src.rsplit('.', 1)[0] %}
{% set ext = src.rsplit('.', 1)[1] %}

<picture class="lazy-image-wrapper">
    {# WebP source for modern browsers #}
    <source
        type="image/webp"
        srcset="{{ base_url }}_small.webp 300w,
                {{ base_url }}_medium.webp 600w,
                {{ base_url }}_large.webp 1200w"
        sizes="{{ img_sizes }}"
    >

    {# JPEG/PNG fallback for older browsers #}
    <source
        type="image/{{ 'jpeg' if ext in ['jpg', 'jpeg'] else ext }}"
        srcset="{{ base_url }}_small.{{ ext }} 300w,
                {{ base_url }}_medium.{{ ext }} 600w,
                {{ base_url }}_large.{{ ext }} 1200w"
        sizes="{{ img_sizes }}"
    >

    {# Default img tag #}
    <img
        src="{{ src }}"
        alt="{{ alt }}"
        {% if img_class %}class="{{ img_class }}"{% endif %}
        {% if img_width %}width="{{ img_width }}"{% endif %}
        {% if img_height %}height="{{ img_height }}"{% endif %}
        loading="{{ img_loading }}"
        decoding="async"
        onload="this.classList.add('loaded')"
    >
</picture>

<style>
.lazy-image-wrapper {
    display: block;
    position: relative;
    overflow: hidden;
    background-color: #f0f0f0;
}

.lazy-image-wrapper img {
    width: 100%;
    height: auto;
    opacity: 0;
    transition: opacity 0.3s ease-in-out;
}

.lazy-image-wrapper img.loaded {
    opacity: 1;
}

/* Blur-up effect (optional) */
.lazy-image-wrapper::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%);
    animation: pulse 1.5s ease-in-out infinite;
}

.lazy-image-wrapper img.loaded ~ ::before {
    display: none;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}
</style>

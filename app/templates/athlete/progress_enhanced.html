{% extends "base.html" %}

{% block title %}Statistiche e Progressi - Atlas Performance{% endblock %}

{% block extra_css %}
<style>
    /* Animations */
    @keyframes fadeInUp {
        from { opacity: 0; transform: translateY(30px); }
        to { opacity: 1; transform: translateY(0); }
    }

    @keyframes slideInRight {
        from { opacity: 0; transform: translateX(30px); }
        to { opacity: 1; transform: translateX(0); }
    }

    @keyframes scaleIn {
        from { opacity: 0; transform: scale(0.95); }
        to { opacity: 1; transform: scale(1); }
    }

    @keyframes shimmer {
        0% { background-position: -1000px 0; }
        100% { background-position: 1000px 0; }
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.05); }
    }

    /* Premium Card */
    .premium-card {
        background: white;
        border-radius: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
    }

    .premium-card:hover {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        transform: translateY(-4px);
    }

    /* Gradient Header */
    .gradient-header {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        position: relative;
        overflow: hidden;
    }

    .gradient-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: shimmer 3s infinite;
    }

    /* Stats Card */
    .stat-card {
        padding: 24px;
        border-radius: 20px;
        position: relative;
        overflow: hidden;
        transition: all 0.3s ease;
    }

    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(135deg, transparent 0%, rgba(255,255,255,0.15) 100%);
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .stat-card:hover::before {
        opacity: 1;
    }

    .stat-card:hover {
        transform: translateY(-6px) scale(1.02);
    }

    /* Chart Container */
    .chart-container {
        position: relative;
        height: 350px;
        width: 100%;
    }

    /* Timeline */
    .timeline {
        position: relative;
        padding: 20px 0;
    }

    .timeline::before {
        content: '';
        position: absolute;
        top: 0;
        bottom: 0;
        left: 30px;
        width: 4px;
        background: linear-gradient(180deg, #3b82f6, #8b5cf6, #ec4899);
    }

    .timeline-item {
        position: relative;
        padding-left: 80px;
        margin-bottom: 40px;
    }

    .timeline-marker {
        position: absolute;
        left: 0;
        top: 0;
        width: 60px;
        height: 60px;
        border-radius: 50%;
        background: linear-gradient(135deg, #fbbf24, #f59e0b);
        display: flex;
        align-items: center;
        justify-center;
        box-shadow: 0 8px 16px rgba(245, 158, 11, 0.4);
        z-index: 10;
        animation: pulse 2s infinite;
    }

    .timeline-content {
        background: white;
        padding: 24px;
        border-radius: 16px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        border: 2px solid #f3f4f6;
        transition: all 0.3s ease;
    }

    .timeline-content:hover {
        border-color: #fbbf24;
        transform: translateX(8px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    /* Measurement Card */
    .measurement-card {
        background: white;
        border-radius: 20px;
        padding: 24px;
        border: 2px solid #e5e7eb;
        transition: all 0.3s ease;
    }

    .measurement-card:hover {
        border-color: #3b82f6;
        transform: translateY(-4px);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.1);
    }

    /* Photo Gallery */
    .photo-gallery {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
        gap: 16px;
    }

    .photo-item {
        position: relative;
        aspect-ratio: 3/4;
        border-radius: 16px;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    .photo-item:hover {
        transform: scale(1.05);
        box-shadow: 0 12px 24px rgba(0, 0, 0, 0.2);
    }

    .photo-item img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .photo-overlay {
        position: absolute;
        bottom: 0;
        left: 0;
        right: 0;
        padding: 12px;
        background: linear-gradient(to top, rgba(0,0,0,0.8), transparent);
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    .photo-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        padding: 6px 12px;
        background: rgba(59, 130, 246, 0.9);
        backdrop-filter: blur(10px);
        color: white;
        border-radius: 8px;
        font-weight: 700;
        font-size: 12px;
    }

    /* Upload Zone */
    .upload-zone {
        border: 3px dashed #d1d5db;
        border-radius: 20px;
        padding: 40px;
        text-align: center;
        transition: all 0.3s ease;
        cursor: pointer;
        background: #f9fafb;
    }

    .upload-zone:hover {
        border-color: #3b82f6;
        background: #eff6ff;
    }

    .upload-zone.dragging {
        border-color: #3b82f6;
        background: #dbeafe;
        transform: scale(1.02);
    }

    /* Tab Navigation */
    .tab-nav {
        display: flex;
        gap: 8px;
        padding: 6px;
        background: #f3f4f6;
        border-radius: 16px;
        margin-bottom: 24px;
    }

    .tab-button {
        flex: 1;
        padding: 12px 24px;
        border-radius: 12px;
        font-weight: 600;
        transition: all 0.3s ease;
        cursor: pointer;
        border: none;
        background: transparent;
        color: #6b7280;
    }

    .tab-button.active {
        background: white;
        color: #3b82f6;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .tab-button:hover:not(.active) {
        color: #3b82f6;
    }

    .tab-content {
        display: none;
    }

    .tab-content.active {
        display: block;
    }

    /* Comparison Slider */
    .comparison-container {
        position: relative;
        aspect-ratio: 16/9;
        border-radius: 20px;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
    }

    .comparison-slider {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 50%;
        width: 4px;
        background: white;
        cursor: ew-resize;
        z-index: 10;
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
    }

    .comparison-slider::before {
        content: 'âŸ·';
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 40px;
        height: 40px;
        background: white;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 20px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    /* Mobile Responsive */
    @media (max-width: 768px) {
        .premium-card {
            border-radius: 16px;
        }

        .stat-card {
            padding: 16px;
            border-radius: 16px;
        }

        .chart-container {
            height: 250px;
        }

        .timeline-item {
            padding-left: 60px;
        }

        .timeline-marker {
            width: 48px;
            height: 48px;
        }

        .timeline::before {
            left: 24px;
        }

        .photo-gallery {
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 12px;
        }

        .upload-zone {
            padding: 24px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 py-8 space-y-8">

    <!-- Header -->
    <div class="premium-card gradient-header fade-in-up">
        <div class="relative z-10 px-8 py-12">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="text-center md:text-left">
                    <h1 class="text-4xl md:text-5xl font-bold text-white mb-3">
                        ðŸ“Š Statistiche e Progressi
                    </h1>
                    <p class="text-xl text-white/90">Analizza i tuoi miglioramenti nel tempo</p>
                </div>
                <a href="{{ url_for('athlete.dashboard') }}" class="btn-premium" style="background: rgba(255, 255, 255, 0.2); color: white; backdrop-filter: blur(10px); padding: 12px 24px; border-radius: 12px; font-weight: 700; transition: all 0.3s;">
                    <i class="fas fa-arrow-left mr-2"></i>Dashboard
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Stats Summary -->
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
        <div class="stat-card bg-gradient-to-br from-blue-500 to-blue-600 text-white scale-in" style="animation-delay: 0.1s;">
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-3">
                    <i class="fas fa-dumbbell text-4xl opacity-80"></i>
                    <span class="text-5xl font-bold">{{ check_ins|length }}</span>
                </div>
                <p class="text-lg font-semibold opacity-95">Check-in Totali</p>
            </div>
        </div>

        <div class="stat-card bg-gradient-to-br from-purple-500 to-purple-600 text-white scale-in" style="animation-delay: 0.2s;">
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-3">
                    <i class="fas fa-trophy text-4xl opacity-80"></i>
                    <span class="text-5xl font-bold">{{ personal_records|length }}</span>
                </div>
                <p class="text-lg font-semibold opacity-95">Record Personali</p>
            </div>
        </div>

        <div class="stat-card bg-gradient-to-br from-green-500 to-green-600 text-white scale-in" style="animation-delay: 0.3s;">
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-3">
                    <i class="fas fa-chart-line text-4xl opacity-80"></i>
                    {% if check_ins and check_ins|length >= 2 %}
                        {% set weight_change = check_ins[0].weight - check_ins[-1].weight %}
                        <span class="text-5xl font-bold">
                            {{ "%.1f"|format(weight_change|abs) }}
                        </span>
                    {% else %}
                        <span class="text-5xl font-bold">0</span>
                    {% endif %}
                </div>
                <p class="text-lg font-semibold opacity-95">Kg Variazione Peso</p>
            </div>
        </div>

        <div class="stat-card bg-gradient-to-br from-orange-500 to-orange-600 text-white scale-in" style="animation-delay: 0.4s;">
            <div class="relative z-10">
                <div class="flex items-center justify-between mb-3">
                    <i class="fas fa-calendar-check text-4xl opacity-80"></i>
                    {% if check_ins %}
                        <span class="text-5xl font-bold">{{ ((check_ins|length / 52 * 100)|round)|int }}%</span>
                    {% else %}
                        <span class="text-5xl font-bold">0%</span>
                    {% endif %}
                </div>
                <p class="text-lg font-semibold opacity-95">Consistenza Annuale</p>
            </div>
        </div>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-nav">
        <button class="tab-button active" onclick="switchTab('charts')">
            <i class="fas fa-chart-line mr-2"></i>Grafici
        </button>
        <button class="tab-button" onclick="switchTab('records')">
            <i class="fas fa-trophy mr-2"></i>Record
        </button>
        <button class="tab-button" onclick="switchTab('measurements')">
            <i class="fas fa-ruler-combined mr-2"></i>Misurazioni
        </button>
        <button class="tab-button" onclick="switchTab('photos')">
            <i class="fas fa-images mr-2"></i>Foto
        </button>
    </div>

    <!-- Charts Tab -->
    <div id="charts-tab" class="tab-content active">
        <!-- Progress Charts -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Weight Progress Chart -->
            <div class="premium-card">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-weight text-white"></i>
                            </div>
                            Andamento Peso
                        </h2>
                        <select class="px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium focus:outline-none focus:ring-2 focus:ring-blue-500"
                                onchange="updateWeightChart(this.value)">
                            <option value="30">30 giorni</option>
                            <option value="90" selected>90 giorni</option>
                            <option value="180">6 mesi</option>
                            <option value="365">1 anno</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="weightProgressChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Strength Progress Chart -->
            <div class="premium-card">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-orange-500 to-red-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-dumbbell text-white"></i>
                            </div>
                            Progressi Forza
                        </h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="strengthChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Volume Chart -->
            <div class="premium-card">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-green-500 to-emerald-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-chart-bar text-white"></i>
                            </div>
                            Volume Settimanale
                        </h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="weeklyVolumeChart"></canvas>
                    </div>
                </div>
            </div>

            <!-- Body Fat Percentage Chart -->
            <div class="premium-card">
                <div class="p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                            <div class="w-10 h-10 bg-gradient-to-br from-purple-500 to-pink-600 rounded-xl flex items-center justify-center">
                                <i class="fas fa-percentage text-white"></i>
                            </div>
                            Body Fat %
                        </h2>
                    </div>
                    <div class="chart-container">
                        <canvas id="bodyFatChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Records Tab -->
    <div id="records-tab" class="tab-content">
        <div class="premium-card">
            <div class="p-6">
                <h2 class="text-2xl font-bold text-gray-900 mb-6 flex items-center gap-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-yellow-500 to-orange-600 rounded-xl flex items-center justify-center">
                        <i class="fas fa-trophy text-white"></i>
                    </div>
                    Timeline Record Personali
                </h2>

                {% if personal_records %}
                <div class="timeline">
                    {% for pr in personal_records %}
                    <div class="timeline-item">
                        <div class="timeline-marker">
                            <i class="fas fa-medal text-white text-2xl"></i>
                        </div>
                        <div class="timeline-content">
                            <div class="flex items-start justify-between mb-3">
                                <div>
                                    <h3 class="text-xl font-bold text-gray-900 mb-1">{{ pr.exercise_name or 'Esercizio' }}</h3>
                                    <p class="text-sm text-gray-500">{{ pr.date_achieved.strftime('%d %B %Y') }}</p>
                                </div>
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-bold">
                                    NEW PR
                                </span>
                            </div>
                            <div class="grid grid-cols-3 gap-4">
                                <div>
                                    <p class="text-sm font-semibold text-gray-600 mb-1">Peso</p>
                                    <p class="text-3xl font-bold text-gray-900">{{ pr.weight_lifted }}<span class="text-lg">kg</span></p>
                                </div>
                                <div>
                                    <p class="text-sm font-semibold text-gray-600 mb-1">Reps</p>
                                    <p class="text-3xl font-bold text-gray-900">{{ pr.reps }}</p>
                                </div>
                                <div>
                                    <p class="text-sm font-semibold text-gray-600 mb-1">1RM Est.</p>
                                    <p class="text-3xl font-bold text-gray-900">{{ (pr.weight_lifted * (1 + pr.reps / 30))|round }}<span class="text-lg">kg</span></p>
                                </div>
                            </div>
                            {% if pr.notes %}
                            <div class="mt-4 pt-4 border-t border-gray-200">
                                <p class="text-sm text-gray-600">
                                    <i class="fas fa-comment-alt text-blue-500 mr-2"></i>{{ pr.notes }}
                                </p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-16">
                    <i class="fas fa-trophy text-gray-300 text-6xl mb-4"></i>
                    <h3 class="text-2xl font-bold text-gray-900 mb-2">Nessun Record Ancora</h3>
                    <p class="text-gray-600">Continua ad allenarti e stabilisci i tuoi primi record!</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Measurements Tab -->
    <div id="measurements-tab" class="tab-content">
        <div class="premium-card">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-indigo-500 to-purple-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-ruler-combined text-white"></i>
                        </div>
                        Tracking Misurazioni Corporee
                    </h2>
                    <a href="{{ url_for('athlete.check_in') }}" class="px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-xl font-bold hover:shadow-lg transition">
                        <i class="fas fa-plus mr-2"></i>Nuovo Check-in
                    </a>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="chart-container">
                        <canvas id="chestMeasurementChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="waistMeasurementChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="armMeasurementChart"></canvas>
                    </div>
                    <div class="chart-container">
                        <canvas id="thighMeasurementChart"></canvas>
                    </div>
                </div>

                {% if check_ins %}
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                    {% for checkin in check_ins[:6] %}
                    <div class="measurement-card">
                        <div class="flex items-center justify-between mb-3">
                            <span class="text-sm font-bold text-gray-900">{{ checkin.check_in_date.strftime('%d %b %Y') }}</span>
                            <i class="fas fa-ruler text-blue-500"></i>
                        </div>
                        <div class="space-y-2">
                            {% if checkin.chest %}
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Petto</span>
                                <span class="font-bold text-gray-900">{{ checkin.chest }} cm</span>
                            </div>
                            {% endif %}
                            {% if checkin.waist %}
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Vita</span>
                                <span class="font-bold text-gray-900">{{ checkin.waist }} cm</span>
                            </div>
                            {% endif %}
                            {% if checkin.arm_left %}
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Braccio</span>
                                <span class="font-bold text-gray-900">{{ checkin.arm_left }} cm</span>
                            </div>
                            {% endif %}
                            {% if checkin.thigh_left %}
                            <div class="flex justify-between text-sm">
                                <span class="text-gray-600">Coscia</span>
                                <span class="font-bold text-gray-900">{{ checkin.thigh_left }} cm</span>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Photos Tab -->
    <div id="photos-tab" class="tab-content">
        <div class="premium-card">
            <div class="p-6">
                <div class="flex items-center justify-between mb-6">
                    <h2 class="text-2xl font-bold text-gray-900 flex items-center gap-3">
                        <div class="w-10 h-10 bg-gradient-to-br from-pink-500 to-rose-600 rounded-xl flex items-center justify-center">
                            <i class="fas fa-images text-white"></i>
                        </div>
                        Galleria Foto Progressi
                    </h2>
                </div>

                <!-- Upload Zone -->
                <div class="upload-zone mb-8" id="uploadZone" onclick="document.getElementById('photoInput').click()">
                    <input type="file" id="photoInput" accept="image/*" multiple style="display: none;" onchange="handlePhotoUpload(this)">
                    <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
                    <h3 class="text-xl font-bold text-gray-900 mb-2">Carica Foto Progressi</h3>
                    <p class="text-gray-600 mb-4">Clicca o trascina le immagini qui</p>
                    <span class="inline-block px-6 py-3 bg-blue-500 text-white rounded-xl font-bold">
                        <i class="fas fa-plus mr-2"></i>Seleziona Foto
                    </span>
                </div>

                <!-- Before/After Comparison -->
                <div class="mb-8">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Confronto Prima/Dopo</h3>
                    <div class="comparison-container" id="comparisonContainer">
                        <div style="position: absolute; inset: 0;">
                            <img src="https://via.placeholder.com/800x450/3b82f6/ffffff?text=Foto+Iniziale" alt="Before" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div style="position: absolute; inset: 0; clip-path: inset(0 50% 0 0);" id="afterImage">
                            <img src="https://via.placeholder.com/800x450/10b981/ffffff?text=Foto+Attuale" alt="After" style="width: 100%; height: 100%; object-fit: cover;">
                        </div>
                        <div class="comparison-slider" id="slider"></div>
                    </div>
                    <p class="text-center text-sm text-gray-600 mt-4">
                        <i class="fas fa-info-circle mr-2"></i>Trascina lo slider per confrontare le foto
                    </p>
                </div>

                <!-- Photo Gallery -->
                <h3 class="text-xl font-bold text-gray-900 mb-4">Tutte le Foto</h3>
                <div class="photo-gallery" id="photoGallery">
                    <!-- Sample Photos -->
                    <div class="photo-item">
                        <img src="https://via.placeholder.com/200x267/3b82f6/ffffff?text=Gen+2026" alt="Progress Photo">
                        <div class="photo-badge">Gen 2026</div>
                        <div class="photo-overlay">75 kg</div>
                    </div>
                    <div class="photo-item">
                        <img src="https://via.placeholder.com/200x267/8b5cf6/ffffff?text=Dic+2025" alt="Progress Photo">
                        <div class="photo-badge">Dic 2025</div>
                        <div class="photo-overlay">76.5 kg</div>
                    </div>
                    <div class="photo-item">
                        <img src="https://via.placeholder.com/200x267/ec4899/ffffff?text=Nov+2025" alt="Progress Photo">
                        <div class="photo-badge">Nov 2025</div>
                        <div class="photo-overlay">78 kg</div>
                    </div>
                    <div class="photo-item">
                        <img src="https://via.placeholder.com/200x267/f59e0b/ffffff?text=Ott+2025" alt="Progress Photo">
                        <div class="photo-badge">Ott 2025</div>
                        <div class="photo-overlay">79.5 kg</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script>
// Tab Switching
function switchTab(tabName) {
    // Hide all tabs
    document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.remove('active');
    });

    // Remove active from all buttons
    document.querySelectorAll('.tab-button').forEach(btn => {
        btn.classList.remove('active');
    });

    // Show selected tab
    document.getElementById(tabName + '-tab').classList.add('active');

    // Set active button
    event.target.closest('.tab-button').classList.add('active');
}

// Initialize Charts
document.addEventListener('DOMContentLoaded', function() {
    initWeightChart();
    initStrengthChart();
    initVolumeChart();
    initBodyFatChart();
    initMeasurementCharts();
    initComparisonSlider();
});

// Weight Progress Chart
function initWeightChart() {
    const ctx = document.getElementById('weightProgressChart');
    if (!ctx) return;

    fetch('/athlete/api/weight-data?days=90')
        .then(res => res.json())
        .then(data => {
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.labels || [],
                    datasets: [{
                        label: 'Peso (kg)',
                        data: data.data || [],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 6,
                        pointBackgroundColor: '#3b82f6',
                        pointBorderColor: '#fff',
                        pointBorderWidth: 2,
                        pointHoverRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: context => `Peso: ${context.parsed.y} kg`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: false,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { callback: value => value + ' kg' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        });
}

// Strength Progress Chart
function initStrengthChart() {
    const ctx = document.getElementById('strengthChart');
    if (!ctx) return;

    // Sample data - replace with API call
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Panca', 'Squat', 'Stacco', 'Military Press'],
            datasets: [{
                label: '1RM (kg)',
                data: [100, 140, 160, 70],
                backgroundColor: [
                    'rgba(249, 115, 22, 0.8)',
                    'rgba(239, 68, 68, 0.8)',
                    'rgba(220, 38, 38, 0.8)',
                    'rgba(251, 146, 60, 0.8)'
                ],
                borderRadius: 10,
                borderSkipped: false
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                    ticks: { callback: value => value + ' kg' }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
}

// Weekly Volume Chart
function initVolumeChart() {
    const ctx = document.getElementById('weeklyVolumeChart');
    if (!ctx) return;

    fetch('/athlete/api/volume-data')
        .then(res => res.json())
        .then(data => {
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.labels || [],
                    datasets: [{
                        label: 'Volume (kg)',
                        data: data.data || [],
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderRadius: 10,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: {
                            backgroundColor: 'rgba(0, 0, 0, 0.8)',
                            padding: 12,
                            callbacks: {
                                label: context => `Volume: ${context.parsed.y} kg`
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: { color: 'rgba(0, 0, 0, 0.05)' },
                            ticks: { callback: value => value + ' kg' }
                        },
                        x: {
                            grid: { display: false }
                        }
                    }
                }
            });
        });
}

// Body Fat Chart
function initBodyFatChart() {
    const ctx = document.getElementById('bodyFatChart');
    if (!ctx) return;

    // Sample data
    new Chart(ctx, {
        type: 'line',
        data: {
            labels: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu'],
            datasets: [{
                label: 'Body Fat %',
                data: [18.5, 17.8, 17.2, 16.5, 15.9, 15.3],
                borderColor: '#a855f7',
                backgroundColor: 'rgba(168, 85, 247, 0.1)',
                tension: 0.4,
                fill: true,
                pointRadius: 6,
                pointBackgroundColor: '#a855f7',
                pointBorderColor: '#fff',
                pointBorderWidth: 2
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { display: false },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    callbacks: {
                        label: context => `BF: ${context.parsed.y}%`
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: false,
                    grid: { color: 'rgba(0, 0, 0, 0.05)' },
                    ticks: { callback: value => value + '%' }
                },
                x: {
                    grid: { display: false }
                }
            }
        }
    });
}

// Measurement Charts
function initMeasurementCharts() {
    const measurements = [
        { id: 'chestMeasurementChart', label: 'Petto (cm)', color: '#3b82f6', data: [95, 96, 97, 98, 99, 100] },
        { id: 'waistMeasurementChart', label: 'Vita (cm)', color: '#10b981', data: [85, 84, 83, 82, 81, 80] },
        { id: 'armMeasurementChart', label: 'Braccio (cm)', color: '#f59e0b', data: [35, 35.5, 36, 36.5, 37, 37.5] },
        { id: 'thighMeasurementChart', label: 'Coscia (cm)', color: '#8b5cf6', data: [55, 55.5, 56, 56.5, 57, 57.5] }
    ];

    measurements.forEach(m => {
        const ctx = document.getElementById(m.id);
        if (!ctx) return;

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu'],
                datasets: [{
                    label: m.label,
                    data: m.data,
                    borderColor: m.color,
                    backgroundColor: m.color + '20',
                    tension: 0.4,
                    fill: true,
                    pointRadius: 5,
                    pointBackgroundColor: m.color,
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { display: true, position: 'top' },
                    tooltip: {
                        backgroundColor: 'rgba(0, 0, 0, 0.8)',
                        padding: 10
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: { color: 'rgba(0, 0, 0, 0.05)' },
                        ticks: { callback: value => value + ' cm' }
                    },
                    x: {
                        grid: { display: false }
                    }
                }
            }
        });
    });
}

// Comparison Slider
function initComparisonSlider() {
    const container = document.getElementById('comparisonContainer');
    const slider = document.getElementById('slider');
    const afterImage = document.getElementById('afterImage');

    if (!container || !slider || !afterImage) return;

    let isDragging = false;

    slider.addEventListener('mousedown', () => isDragging = true);
    document.addEventListener('mouseup', () => isDragging = false);

    container.addEventListener('mousemove', (e) => {
        if (!isDragging) return;

        const rect = container.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const percentage = (x / rect.width) * 100;

        if (percentage >= 0 && percentage <= 100) {
            slider.style.left = percentage + '%';
            afterImage.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
        }
    });

    // Touch support
    slider.addEventListener('touchstart', () => isDragging = true);
    document.addEventListener('touchend', () => isDragging = false);

    container.addEventListener('touchmove', (e) => {
        if (!isDragging) return;
        e.preventDefault();

        const rect = container.getBoundingClientRect();
        const x = e.touches[0].clientX - rect.left;
        const percentage = (x / rect.width) * 100;

        if (percentage >= 0 && percentage <= 100) {
            slider.style.left = percentage + '%';
            afterImage.style.clipPath = `inset(0 ${100 - percentage}% 0 0)`;
        }
    });
}

// Photo Upload
function handlePhotoUpload(input) {
    const files = input.files;
    if (files.length === 0) return;

    // Here you would implement actual file upload to server
    alert(`${files.length} foto selezionate. Implementare upload al server.`);
}

// Drag and Drop
const uploadZone = document.getElementById('uploadZone');
if (uploadZone) {
    uploadZone.addEventListener('dragover', (e) => {
        e.preventDefault();
        uploadZone.classList.add('dragging');
    });

    uploadZone.addEventListener('dragleave', () => {
        uploadZone.classList.remove('dragging');
    });

    uploadZone.addEventListener('drop', (e) => {
        e.preventDefault();
        uploadZone.classList.remove('dragging');

        const files = e.dataTransfer.files;
        if (files.length > 0) {
            // Handle file upload
            alert(`${files.length} foto caricate via drag&drop.`);
        }
    });
}

function updateWeightChart(days) {
    // Implement chart update with new data range
    console.log('Updating chart for last', days, 'days');
}
</script>
{% endblock %}

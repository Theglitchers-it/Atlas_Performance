{% extends "base.html" %}

{% block title %}Il Mio Profilo - Atlas Performance{% endblock %}

{% block content %}
<style>
    .premium-card {
        border-radius: 24px;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        overflow: hidden;
        animation: fadeInUp 0.6s ease-out forwards;
        opacity: 0;
        transform: translateY(20px);
    }

    .premium-card:hover {
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.15), 0 10px 10px -5px rgba(0, 0, 0, 0.1);
        transform: translateY(-6px);
    }

    @keyframes fadeInUp {
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .gradient-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        position: relative;
        overflow: hidden;
        animation: fadeInDown 0.8s ease-out forwards;
    }

    @keyframes fadeInDown {
        from {
            opacity: 0;
            transform: translateY(-20px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .gradient-header::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.15) 0%, transparent 70%);
        animation: rotate 20s linear infinite;
    }

    @keyframes rotate {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }

    @keyframes fadeInUpSlow {
        from {
            opacity: 0;
            transform: translateY(30px);
        }
        to {
            opacity: 1;
            transform: translateY(0);
        }
    }

    .fade-in-up {
        animation: fadeInUpSlow 0.7s ease-out forwards;
        opacity: 0;
        transform: translateY(30px);
    }

    .tab-button {
        padding: 14px 28px;
        border-radius: 16px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        border: 2px solid transparent;
        background: transparent;
        color: #6b7280;
        font-weight: 600;
        font-size: 15px;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        position: relative;
        overflow: hidden;
    }

    .tab-button::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(102, 126, 234, 0.2);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .tab-button:active::before {
        width: 300px;
        height: 300px;
    }

    .tab-button:hover {
        background: rgba(102, 126, 234, 0.12);
        color: #667eea;
        border-color: rgba(102, 126, 234, 0.3);
        transform: translateY(-3px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .tab-button.active {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 10px 20px -4px rgba(102, 126, 234, 0.5);
        transform: translateY(-3px);
    }

    .tab-button.active:hover {
        box-shadow: 0 12px 24px -4px rgba(102, 126, 234, 0.6);
    }

    .tab-content {
        display: none;
        animation: fadeInUp 0.5s ease-out forwards;
        opacity: 1;
        transform: translateY(0);
    }

    .tab-content.active {
        display: block;
    }

    .avatar-upload {
        position: relative;
        width: 150px;
        height: 150px;
        border-radius: 50%;
        overflow: hidden;
        cursor: pointer;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        animation: zoomIn 0.6s ease-out forwards;
    }

    @keyframes zoomIn {
        from {
            opacity: 0;
            transform: scale(0.5);
        }
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .avatar-upload:hover {
        transform: scale(1.08) rotate(2deg);
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.3);
    }

    .avatar-upload::after {
        content: '\f030';
        font-family: 'Font Awesome 5 Free';
        font-weight: 900;
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        font-size: 24px;
        color: white;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .avatar-upload:hover::after {
        opacity: 1;
    }

    .avatar-upload:hover img {
        filter: brightness(0.7);
    }

    .premium-input {
        width: 100%;
        padding: 14px 18px;
        border: 2px solid #e5e7eb;
        border-radius: 14px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 15px;
        background: #fafbfc;
    }

    .premium-input:hover {
        border-color: #d1d5db;
        background: white;
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    }

    .premium-input:focus {
        outline: none;
        border-color: #667eea;
        box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15), 0 4px 12px rgba(102, 126, 234, 0.1);
        background: white;
        transform: translateY(-2px);
    }

    .premium-btn {
        padding: 14px 36px;
        border-radius: 14px;
        font-weight: 600;
        font-size: 15px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        border: none;
        position: relative;
        overflow: hidden;
    }

    .premium-btn::before {
        content: '';
        position: absolute;
        top: 50%;
        left: 50%;
        width: 0;
        height: 0;
        border-radius: 50%;
        background: rgba(255,255,255,0.3);
        transform: translate(-50%, -50%);
        transition: width 0.6s, height 0.6s;
    }

    .premium-btn:active::before {
        width: 300px;
        height: 300px;
    }

    .premium-btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        box-shadow: 0 6px 12px -2px rgba(102, 126, 234, 0.35);
    }

    .premium-btn-primary:hover {
        transform: translateY(-4px);
        box-shadow: 0 14px 28px -4px rgba(102, 126, 234, 0.5);
    }

    .premium-btn-primary:active {
        transform: translateY(-2px);
    }

    .premium-btn-secondary {
        background: white;
        color: #667eea;
        border: 2px solid #667eea;
    }

    .premium-btn-secondary:hover {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        transform: translateY(-3px);
        box-shadow: 0 10px 20px -4px rgba(102, 126, 234, 0.4);
    }

    .stat-card {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
        border-radius: 12px;
        padding: 20px;
        border: 1px solid rgba(102, 126, 234, 0.2);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        animation: scaleIn 0.5s ease-out forwards;
        opacity: 0;
        transform: scale(0.95);
    }

    .stat-card:nth-child(1) { animation-delay: 0.1s; }
    .stat-card:nth-child(2) { animation-delay: 0.2s; }
    .stat-card:nth-child(3) { animation-delay: 0.3s; }

    @keyframes scaleIn {
        to {
            opacity: 1;
            transform: scale(1);
        }
    }

    .stat-card:hover {
        transform: translateY(-4px) scale(1.02);
        border-color: rgba(102, 126, 234, 0.6);
        box-shadow: 0 8px 24px rgba(102, 126, 234, 0.25);
    }

    .password-strength {
        height: 4px;
        border-radius: 2px;
        background: #e5e7eb;
        margin-top: 8px;
        overflow: hidden;
    }

    .password-strength-bar {
        height: 100%;
        transition: all 0.3s ease;
        border-radius: 2px;
    }

    .strength-weak { background: #ef4444; width: 33%; }
    .strength-medium { background: #f59e0b; width: 66%; }
    .strength-strong { background: #10b981; width: 100%; }

    .notification-badge {
        position: absolute;
        top: -5px;
        right: -5px;
        background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        color: white;
        border-radius: 50%;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 10px;
        font-weight: 700;
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0%, 100% { transform: scale(1); }
        50% { transform: scale(1.1); }
    }

    /* Mobile First Responsive Design */
    @media (max-width: 640px) {
        /* Header Adjustments */
        .gradient-header {
            padding: 1.5rem !important;
        }

        .gradient-header h1 {
            font-size: 1.875rem !important;
        }

        .gradient-header p {
            font-size: 0.875rem !important;
        }

        /* Tab Buttons Mobile */
        .tab-button {
            padding: 10px 12px;
            font-size: 12px;
            border-radius: 12px;
            min-width: auto;
            white-space: nowrap;
        }

        .tab-button i {
            font-size: 14px;
            margin-right: 4px;
        }

        /* Hide long text on mobile, show only short version */
        .tab-button .tab-text-full {
            display: none;
        }

        .tab-button .tab-text-short {
            display: inline;
        }

        /* Premium Cards */
        .premium-card {
            border-radius: 16px;
        }

        .premium-card.p-6 {
            padding: 1rem !important;
        }

        .premium-card.p-8 {
            padding: 1.25rem !important;
        }

        /* Avatar */
        .avatar-upload {
            width: 120px;
            height: 120px;
        }

        /* Stats Cards */
        .stat-card {
            padding: 14px;
            border-radius: 10px;
        }

        .stat-card .text-2xl {
            font-size: 1.5rem;
        }

        /* Form Inputs */
        .premium-input {
            padding: 12px 14px;
            font-size: 14px;
        }

        /* Buttons */
        .premium-btn {
            padding: 12px 24px;
            font-size: 14px;
        }

        /* Measurements Section */
        #content-measurements h4 {
            font-size: 1rem !important;
        }

        #content-measurements .text-2xl {
            font-size: 1.5rem;
        }

        #content-measurements .text-xl {
            font-size: 1.125rem;
        }

        /* Goals Section */
        #content-goals .text-5xl {
            font-size: 2rem;
        }

        #content-goals .text-2xl {
            font-size: 1.5rem;
        }

        /* Chart adjustments */
        canvas#weightTrendChart {
            max-height: 200px !important;
        }
    }

    @media (min-width: 641px) {
        /* Show full text on larger screens */
        .tab-button .tab-text-full {
            display: inline;
        }

        .tab-button .tab-text-short {
            display: none;
        }

        .tab-button i {
            margin-right: 8px;
        }
    }

    @media (min-width: 641px) and (max-width: 768px) {
        .tab-button {
            padding: 12px 20px;
            font-size: 14px;
        }

        .premium-card {
            border-radius: 20px;
        }

        .avatar-upload {
            width: 140px;
            height: 140px;
        }
    }

    /* Landscape Mobile Optimization */
    @media (max-width: 896px) and (orientation: landscape) {
        .gradient-header {
            padding: 1rem !important;
        }

        .avatar-upload {
            width: 100px;
            height: 100px;
        }
    }
</style>

<div class="max-w-7xl mx-auto px-4 py-8 space-y-8">
    <!-- Header with Profile Info -->
    <div class="premium-card gradient-header fade-in-up">
        <div class="relative z-10 px-8 py-12">
            <div class="flex flex-col md:flex-row items-center justify-between gap-6">
                <div class="text-center md:text-left">
                    <div class="flex items-center gap-3 mb-3">
                        <div class="w-16 h-16 bg-white bg-opacity-25 rounded-2xl flex items-center justify-center backdrop-blur-sm shadow-lg">
                            <i class="fas fa-user-circle text-4xl text-white"></i>
                        </div>
                        <h1 class="text-4xl md:text-5xl font-bold text-white">Il Mio Profilo</h1>
                    </div>
                    <p class="text-xl text-white/90 md:ml-20">Gestisci le tue informazioni personali e impostazioni</p>
                </div>
                <div class="fade-in-up" style="animation-delay: 0.1s;">
                    <div class="bg-white bg-opacity-25 backdrop-blur-lg rounded-2xl px-8 py-5 border-2 border-white border-opacity-30 shadow-lg">
                        <div class="text-sm text-white mb-1 font-semibold">Membro dal</div>
                        <div class="text-4xl font-bold text-white">{{ current_user.created_at.strftime('%B %Y') if current_user.created_at else 'N/A' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="mx-auto pb-12">
        <!-- Tabs Navigation -->
        <div class="premium-card mb-8 p-4 sm:p-6 fade-in-up" style="animation-delay: 0.2s;">
            <div class="flex flex-wrap gap-2 sm:gap-3">
                <button class="tab-button active" onclick="switchTab('overview')" id="tab-overview">
                    <i class="fas fa-chart-line"></i>
                    <span class="tab-text-short">Graf</span>
                    <span class="tab-text-full">Panoramica</span>
                </button>
                <button class="tab-button" onclick="switchTab('personal')" id="tab-personal">
                    <i class="fas fa-user-edit"></i>
                    <span class="tab-text-short">Info</span>
                    <span class="tab-text-full">Informazioni Personali</span>
                </button>
                <button class="tab-button" onclick="switchTab('security')" id="tab-security">
                    <i class="fas fa-shield-alt"></i>
                    <span class="tab-text-short">Sicur.</span>
                    <span class="tab-text-full">Sicurezza</span>
                </button>
                <button class="tab-button" onclick="switchTab('preferences')" id="tab-preferences">
                    <i class="fas fa-cog"></i>
                    <span class="tab-text-short">Pref.</span>
                    <span class="tab-text-full">Preferenze</span>
                </button>
                <button class="tab-button" onclick="switchTab('measurements')" id="tab-measurements">
                    <i class="fas fa-ruler"></i>
                    <span class="tab-text-short">Misur.</span>
                    <span class="tab-text-full">Misurazioni</span>
                </button>
                <button class="tab-button" onclick="switchTab('goals')" id="tab-goals">
                    <i class="fas fa-bullseye"></i>
                    <span class="tab-text-short">Obiett.</span>
                    <span class="tab-text-full">Obiettivi</span>
                </button>
            </div>
        </div>

        <!-- Tab Content: Overview -->
        <div id="content-overview" class="tab-content active">
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <!-- Avatar & Basic Info -->
                <div class="lg:col-span-1">
                    <div class="premium-card p-6 text-center fade-in-up" style="animation-delay: 0.3s;">
                        <form id="avatarForm" enctype="multipart/form-data">
                            <div class="avatar-upload mx-auto mb-4" onclick="document.getElementById('avatarInput').click()">
                                <img id="avatarPreview" src="{{ current_user.avatar_url if current_user.avatar_url else 'https://ui-avatars.com/api/?name=' + current_user.first_name + '+' + current_user.last_name + '&size=150&background=667eea&color=fff' }}" alt="Avatar" class="w-full h-full object-cover">
                            </div>
                            <input type="file" id="avatarInput" name="avatar" accept="image/*" class="hidden" onchange="previewAvatar(this)">
                        </form>
                        <h2 class="text-2xl font-bold text-gray-800 mb-1">{{ current_user.first_name }} {{ current_user.last_name }}</h2>
                        <p class="text-gray-500 mb-4">{{ current_user.email }}</p>
                        <div class="flex items-center justify-center gap-2 mb-4">
                            <span class="px-4 py-1 bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-full text-sm font-semibold">
                                <i class="fas fa-dumbbell mr-1"></i>Atleta
                            </span>
                        </div>
                        <button type="button" onclick="uploadAvatar()" class="premium-btn premium-btn-primary w-full">
                            <i class="fas fa-camera mr-2"></i>Cambia Foto
                        </button>
                    </div>

                    <!-- Quick Stats -->
                    <div class="premium-card p-6 mt-6 fade-in-up" style="animation-delay: 0.4s;">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-bar mr-2 text-purple-600"></i>Statistiche Rapide
                        </h3>
                        <div class="space-y-3">
                            <div class="stat-card">
                                <div class="text-sm text-gray-600 mb-1">Allenamenti Completati</div>
                                <div class="text-2xl font-bold text-purple-600">{{ workout_count if workout_count else 0 }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="text-sm text-gray-600 mb-1">Check-in Totali</div>
                                <div class="text-2xl font-bold text-purple-600">{{ checkin_count if checkin_count else 0 }}</div>
                            </div>
                            <div class="stat-card">
                                <div class="text-sm text-gray-600 mb-1">Giorni di Attività</div>
                                <div class="text-2xl font-bold text-purple-600">{{ days_active if days_active else 0 }}</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main Info -->
                <div class="lg:col-span-2">
                    <!-- Account Overview -->
                    <div class="premium-card p-6 mb-6 fade-in-up" style="animation-delay: 0.5s;">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-info-circle mr-2 text-purple-600"></i>Panoramica Account
                        </h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="text-sm text-gray-600 mb-1 block">Nome Completo</label>
                                <p class="text-gray-800 font-medium">{{ current_user.first_name }} {{ current_user.last_name }}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600 mb-1 block">Email</label>
                                <p class="text-gray-800 font-medium">{{ current_user.email }}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600 mb-1 block">Telefono</label>
                                <p class="text-gray-800 font-medium">{{ current_user.phone if current_user.phone else 'Non impostato' }}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600 mb-1 block">Data di Nascita</label>
                                <p class="text-gray-800 font-medium">{{ current_user.date_of_birth.strftime('%d/%m/%Y') if current_user.date_of_birth else 'Non impostata' }}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600 mb-1 block">Membro dal</label>
                                <p class="text-gray-800 font-medium">{{ current_user.created_at.strftime('%d/%m/%Y') if current_user.created_at else 'N/A' }}</p>
                            </div>
                            <div>
                                <label class="text-sm text-gray-600 mb-1 block">Ultimo Accesso</label>
                                <p class="text-gray-800 font-medium">{{ current_user.last_login.strftime('%d/%m/%Y %H:%M') if current_user.last_login else 'N/A' }}</p>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Activity -->
                    <div class="premium-card p-6 fade-in-up" style="animation-delay: 0.6s;">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-history mr-2 text-purple-600"></i>Attività Recente
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-dumbbell text-white"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800">Allenamento completato</p>
                                        <p class="text-sm text-gray-500">2 ore fa</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-blue-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-clipboard-check text-white"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800">Check-in completato</p>
                                        <p class="text-sm text-gray-500">1 giorno fa</p>
                                    </div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                                <div class="flex items-center gap-3">
                                    <div class="w-10 h-10 bg-purple-500 rounded-full flex items-center justify-center">
                                        <i class="fas fa-user-edit text-white"></i>
                                    </div>
                                    <div>
                                        <p class="font-medium text-gray-800">Profilo aggiornato</p>
                                        <p class="text-sm text-gray-500">3 giorni fa</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Personal Info -->
        <div id="content-personal" class="tab-content">
            <div class="premium-card p-8 fade-in-up">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-user-edit mr-2 text-purple-600"></i>Informazioni Personali
                </h3>
                <form id="personalInfoForm" method="POST" action="{{ url_for('athlete.update_profile') }}">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nome</label>
                            <input type="text" name="first_name" value="{{ current_user.first_name }}" class="premium-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Cognome</label>
                            <input type="text" name="last_name" value="{{ current_user.last_name }}" class="premium-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                            <input type="email" name="email" value="{{ current_user.email }}" class="premium-input" required>
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Telefono</label>
                            <input type="tel" name="phone" value="{{ current_user.phone if current_user.phone else '' }}" class="premium-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Data di Nascita</label>
                            <input type="date" name="date_of_birth" value="{{ current_user.date_of_birth.strftime('%Y-%m-%d') if current_user.date_of_birth else '' }}" class="premium-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Sesso</label>
                            <select name="gender" class="premium-input">
                                <option value="">Seleziona...</option>
                                <option value="M" {% if current_user.gender == 'M' %}selected{% endif %}>Maschio</option>
                                <option value="F" {% if current_user.gender == 'F' %}selected{% endif %}>Femmina</option>
                                <option value="O" {% if current_user.gender == 'O' %}selected{% endif %}>Altro</option>
                            </select>
                        </div>
                    </div>
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Indirizzo</label>
                        <input type="text" name="address" value="{{ current_user.address if current_user.address else '' }}" class="premium-input" placeholder="Via, Numero Civico">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Città</label>
                            <input type="text" name="city" value="{{ current_user.city if current_user.city else '' }}" class="premium-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">CAP</label>
                            <input type="text" name="postal_code" value="{{ current_user.postal_code if current_user.postal_code else '' }}" class="premium-input">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Paese</label>
                            <input type="text" name="country" value="{{ current_user.country if current_user.country else 'Italia' }}" class="premium-input">
                        </div>
                    </div>
                    <div class="mt-8 flex gap-4">
                        <button type="submit" class="premium-btn premium-btn-primary">
                            <i class="fas fa-save mr-2"></i>Salva Modifiche
                        </button>
                        <button type="button" onclick="switchTab('overview')" class="premium-btn premium-btn-secondary">
                            <i class="fas fa-times mr-2"></i>Annulla
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab Content: Security -->
        <div id="content-security" class="tab-content">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Change Password -->
                <div class="premium-card p-8 fade-in-up">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-key mr-2 text-purple-600"></i>Cambia Password
                    </h3>
                    <form id="passwordForm" method="POST" action="{{ url_for('athlete.change_password') }}">
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Password Attuale</label>
                            <input type="password" name="current_password" class="premium-input" required>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Nuova Password</label>
                            <input type="password" name="new_password" id="newPassword" class="premium-input" required oninput="checkPasswordStrength()">
                            <div class="password-strength">
                                <div id="strengthBar" class="password-strength-bar"></div>
                            </div>
                            <p id="strengthText" class="text-xs text-gray-500 mt-2">Inserisci una password</p>
                        </div>
                        <div class="mb-6">
                            <label class="block text-sm font-medium text-gray-700 mb-2">Conferma Nuova Password</label>
                            <input type="password" name="confirm_password" class="premium-input" required>
                        </div>
                        <button type="submit" class="premium-btn premium-btn-primary w-full">
                            <i class="fas fa-lock mr-2"></i>Aggiorna Password
                        </button>
                    </form>
                </div>

                <!-- Security Settings -->
                <div class="premium-card p-8 fade-in-up" style="animation-delay: 0.1s;">
                    <h3 class="text-2xl font-bold text-gray-800 mb-6">
                        <i class="fas fa-shield-alt mr-2 text-purple-600"></i>Impostazioni di Sicurezza
                    </h3>
                    <div class="space-y-4">
                        <div class="p-4 bg-green-50 border border-green-200 rounded-lg">
                            <div class="flex items-center justify-between mb-2">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-check-circle text-green-500 text-xl"></i>
                                    <div>
                                        <p class="font-medium text-gray-800">Autenticazione Email</p>
                                        <p class="text-sm text-gray-500">La tua email è verificata</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-mobile-alt text-gray-500 text-xl"></i>
                                    <div>
                                        <p class="font-medium text-gray-800">Autenticazione a Due Fattori</p>
                                        <p class="text-sm text-gray-500">Non attiva</p>
                                    </div>
                                </div>
                                <button type="button" class="text-sm text-purple-600 font-medium hover:text-purple-700">Attiva</button>
                            </div>
                        </div>
                        <div class="p-4 bg-gray-50 border border-gray-200 rounded-lg">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <i class="fas fa-history text-gray-500 text-xl"></i>
                                    <div>
                                        <p class="font-medium text-gray-800">Sessioni Attive</p>
                                        <p class="text-sm text-gray-500">1 dispositivo connesso</p>
                                    </div>
                                </div>
                                <button type="button" class="text-sm text-purple-600 font-medium hover:text-purple-700">Gestisci</button>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Login Activity -->
                    <div class="mt-6 pt-6 border-t border-gray-200">
                        <h4 class="font-bold text-gray-800 mb-3">
                            <i class="fas fa-clock mr-2"></i>Accessi Recenti
                        </h4>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600">Oggi, 14:32</span>
                                <span class="text-gray-800 font-medium">Windows PC</span>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span class="text-gray-600">Ieri, 09:15</span>
                                <span class="text-gray-800 font-medium">Windows PC</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Preferences -->
        <div id="content-preferences" class="tab-content">
            <div class="premium-card p-8 fade-in-up">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-cog mr-2 text-purple-600"></i>Preferenze
                </h3>
                <form id="preferencesForm" method="POST" action="{{ url_for('athlete.update_preferences') }}">
                    <!-- Notification Preferences -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-bell mr-2 text-purple-600"></i>Notifiche
                        </h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-800">Notifiche Email</p>
                                    <p class="text-sm text-gray-500">Ricevi aggiornamenti via email</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="email_notifications" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-800">Promemoria Allenamenti</p>
                                    <p class="text-sm text-gray-500">Ricevi promemoria per gli allenamenti</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="workout_reminders" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-800">Notifiche Push</p>
                                    <p class="text-sm text-gray-500">Ricevi notifiche push sul browser</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="push_notifications" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <!-- Language & Region -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-globe mr-2 text-purple-600"></i>Lingua e Regione
                        </h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Lingua</label>
                                <select name="language" class="premium-input">
                                    <option value="it" selected>Italiano</option>
                                    <option value="en">English</option>
                                    <option value="es">Español</option>
                                    <option value="fr">Français</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Fuso Orario</label>
                                <select name="timezone" class="premium-input">
                                    <option value="Europe/Rome" selected>Europe/Rome (GMT+1)</option>
                                    <option value="Europe/London">Europe/London (GMT+0)</option>
                                    <option value="America/New_York">America/New_York (GMT-5)</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="mb-8">
                        <h4 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-user-shield mr-2 text-purple-600"></i>Privacy
                        </h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-800">Profilo Pubblico</p>
                                    <p class="text-sm text-gray-500">Rendi visibile il tuo profilo agli altri utenti</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="public_profile" class="sr-only peer">
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div>
                                    <p class="font-medium text-gray-800">Condividi Progressi</p>
                                    <p class="text-sm text-gray-500">Permetti al trainer di vedere i tuoi progressi</p>
                                </div>
                                <label class="relative inline-flex items-center cursor-pointer">
                                    <input type="checkbox" name="share_progress" class="sr-only peer" checked>
                                    <div class="w-11 h-6 bg-gray-200 peer-focus:outline-none peer-focus:ring-4 peer-focus:ring-purple-300 rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-purple-600"></div>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="flex gap-4">
                        <button type="submit" class="premium-btn premium-btn-primary">
                            <i class="fas fa-save mr-2"></i>Salva Preferenze
                        </button>
                        <button type="button" onclick="switchTab('overview')" class="premium-btn premium-btn-secondary">
                            <i class="fas fa-times mr-2"></i>Annulla
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <!-- Tab Content: Measurements -->
        <div id="content-measurements" class="tab-content">
            <div class="premium-card p-8 fade-in-up">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-ruler mr-2 text-purple-600"></i>Misurazioni Corporee
                </h3>
                <p class="text-gray-600 mb-6">Traccia le tue misurazioni corporee per monitorare i progressi fisici nel tempo.</p>

                <!-- Current Measurements Chart Preview -->
                <div class="mb-8 p-4 sm:p-6 bg-gradient-to-r from-purple-50 to-blue-50 rounded-lg border border-purple-200">
                    <h4 class="text-base sm:text-lg font-bold text-gray-800 mb-3 sm:mb-4">
                        <i class="fas fa-chart-line mr-1 sm:mr-2 text-purple-600"></i>
                        <span class="hidden sm:inline">Andamento Peso</span>
                        <span class="sm:hidden">Peso</span>
                    </h4>
                    <div class="relative" style="height: 180px;">
                        <canvas id="weightTrendChart" class="w-full h-full"></canvas>
                    </div>
                </div>

                <form id="measurementsForm">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Weight -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-weight mr-1 text-purple-600"></i>Peso (kg)
                            </label>
                            <input type="number" step="0.1" name="weight" id="weight" class="premium-input" placeholder="75.5">
                        </div>

                        <!-- Height -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-arrows-alt-v mr-1 text-purple-600"></i>Altezza (cm)
                            </label>
                            <input type="number" step="0.1" name="height" id="height" class="premium-input" placeholder="175">
                        </div>

                        <!-- Body Fat % -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-percentage mr-1 text-purple-600"></i>Massa Grassa (%)
                            </label>
                            <input type="number" step="0.1" name="body_fat" id="body_fat" class="premium-input" placeholder="15.5">
                        </div>

                        <!-- Muscle Mass -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-dumbbell mr-1 text-purple-600"></i>Massa Muscolare (kg)
                            </label>
                            <input type="number" step="0.1" name="muscle_mass" id="muscle_mass" class="premium-input" placeholder="60.0">
                        </div>

                        <!-- Chest -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler-horizontal mr-1 text-purple-600"></i>Petto (cm)
                            </label>
                            <input type="number" step="0.1" name="chest" id="chest" class="premium-input" placeholder="95">
                        </div>

                        <!-- Waist -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler-horizontal mr-1 text-purple-600"></i>Vita (cm)
                            </label>
                            <input type="number" step="0.1" name="waist" id="waist" class="premium-input" placeholder="80">
                        </div>

                        <!-- Hips -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler-horizontal mr-1 text-purple-600"></i>Fianchi (cm)
                            </label>
                            <input type="number" step="0.1" name="hips" id="hips" class="premium-input" placeholder="95">
                        </div>

                        <!-- Arms -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler-horizontal mr-1 text-purple-600"></i>Braccia (cm)
                            </label>
                            <input type="number" step="0.1" name="arms" id="arms" class="premium-input" placeholder="35">
                        </div>

                        <!-- Thighs -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler-horizontal mr-1 text-purple-600"></i>Cosce (cm)
                            </label>
                            <input type="number" step="0.1" name="thighs" id="thighs" class="premium-input" placeholder="55">
                        </div>

                        <!-- Calves -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler-horizontal mr-1 text-purple-600"></i>Polpacci (cm)
                            </label>
                            <input type="number" step="0.1" name="calves" id="calves" class="premium-input" placeholder="38">
                        </div>

                        <!-- BMI (calculated automatically) -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-calculator mr-1 text-purple-600"></i>BMI (calcolato)
                            </label>
                            <input type="text" id="bmi" class="premium-input bg-gray-100" readonly placeholder="--">
                        </div>

                        <!-- Date -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-calendar mr-1 text-purple-600"></i>Data Misurazione
                            </label>
                            <input type="date" name="measurement_date" id="measurement_date" class="premium-input" value="{{ current_date }}">
                        </div>
                    </div>

                    <!-- Notes -->
                    <div class="mt-6">
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-sticky-note mr-1 text-purple-600"></i>Note
                        </label>
                        <textarea name="notes" id="measurement_notes" rows="3" class="premium-input" placeholder="Aggiungi note sulle misurazioni..."></textarea>
                    </div>

                    <div class="mt-8 flex gap-4">
                        <button type="submit" class="premium-btn premium-btn-primary">
                            <i class="fas fa-save mr-2"></i>Salva Misurazione
                        </button>
                        <button type="button" onclick="switchTab('overview')" class="premium-btn premium-btn-secondary">
                            <i class="fas fa-arrow-left mr-2"></i>Torna Indietro
                        </button>
                    </div>
                </form>

                <!-- Measurement History -->
                <div class="mt-8 pt-8 border-t border-gray-200">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-history mr-2 text-purple-600"></i>Storico Misurazioni
                    </h4>
                    <div class="overflow-x-auto">
                        <table class="w-full text-sm">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-4 py-3 text-left text-gray-600 font-semibold">Data</th>
                                    <th class="px-4 py-3 text-left text-gray-600 font-semibold">Peso</th>
                                    <th class="px-4 py-3 text-left text-gray-600 font-semibold">BMI</th>
                                    <th class="px-4 py-3 text-left text-gray-600 font-semibold">Massa Grassa</th>
                                    <th class="px-4 py-3 text-left text-gray-600 font-semibold">Azioni</th>
                                </tr>
                            </thead>
                            <tbody id="measurementHistory">
                                <tr class="border-t">
                                    <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                                        <i class="fas fa-inbox text-4xl mb-2 block"></i>
                                        Nessuna misurazione registrata
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tab Content: Goals -->
        <div id="content-goals" class="tab-content">
            <div class="premium-card p-8 fade-in-up">
                <h3 class="text-2xl font-bold text-gray-800 mb-6">
                    <i class="fas fa-bullseye mr-2 text-purple-600"></i>I Miei Obiettivi
                </h3>
                <p class="text-gray-600 mb-6">Definisci e monitora i tuoi obiettivi di fitness per rimanere motivato e misurare i progressi.</p>

                <!-- Quick Goals Overview -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
                    <div class="p-4 bg-gradient-to-br from-green-50 to-green-100 border border-green-200 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-check-circle text-2xl text-green-600"></i>
                            <span class="text-2xl font-bold text-green-600" id="completedGoals">0</span>
                        </div>
                        <p class="text-sm text-gray-600">Obiettivi Raggiunti</p>
                    </div>
                    <div class="p-4 bg-gradient-to-br from-blue-50 to-blue-100 border border-blue-200 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-spinner text-2xl text-blue-600"></i>
                            <span class="text-2xl font-bold text-blue-600" id="activeGoals">0</span>
                        </div>
                        <p class="text-sm text-gray-600">In Corso</p>
                    </div>
                    <div class="p-4 bg-gradient-to-br from-purple-50 to-purple-100 border border-purple-200 rounded-lg">
                        <div class="flex items-center justify-between mb-2">
                            <i class="fas fa-percentage text-2xl text-purple-600"></i>
                            <span class="text-2xl font-bold text-purple-600" id="goalProgress">0%</span>
                        </div>
                        <p class="text-sm text-gray-600">Progresso Medio</p>
                    </div>
                </div>

                <!-- Add New Goal Form -->
                <form id="goalsForm" class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200">
                    <h4 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-plus-circle mr-2 text-purple-600"></i>Aggiungi Nuovo Obiettivo
                    </h4>

                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Goal Type -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-tag mr-1 text-purple-600"></i>Tipo di Obiettivo
                            </label>
                            <select name="goal_type" id="goal_type" class="premium-input" required>
                                <option value="">Seleziona tipo...</option>
                                <option value="weight">Peso Corporeo</option>
                                <option value="strength">Forza (PR)</option>
                                <option value="body_composition">Composizione Corporea</option>
                                <option value="endurance">Resistenza</option>
                                <option value="flexibility">Flessibilità</option>
                                <option value="habit">Abitudine</option>
                                <option value="custom">Personalizzato</option>
                            </select>
                        </div>

                        <!-- Goal Title -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-heading mr-1 text-purple-600"></i>Titolo Obiettivo
                            </label>
                            <input type="text" name="goal_title" id="goal_title" class="premium-input" placeholder="Es: Raggiungere 80kg di peso" required>
                        </div>

                        <!-- Current Value -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-tachometer-alt mr-1 text-purple-600"></i>Valore Attuale
                            </label>
                            <input type="number" step="0.1" name="current_value" id="current_value" class="premium-input" placeholder="75.5">
                        </div>

                        <!-- Target Value -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-flag-checkered mr-1 text-purple-600"></i>Valore Target
                            </label>
                            <input type="number" step="0.1" name="target_value" id="target_value" class="premium-input" placeholder="80.0" required>
                        </div>

                        <!-- Unit -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-ruler mr-1 text-purple-600"></i>Unità di Misura
                            </label>
                            <input type="text" name="unit" id="unit" class="premium-input" placeholder="kg, cm, reps, %...">
                        </div>

                        <!-- Target Date -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-calendar-check mr-1 text-purple-600"></i>Data Target
                            </label>
                            <input type="date" name="target_date" id="target_date" class="premium-input">
                        </div>

                        <!-- Priority -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-star mr-1 text-purple-600"></i>Priorità
                            </label>
                            <div class="flex gap-3">
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="priority" value="low" class="mr-2">
                                    <span class="px-4 py-2 bg-gray-200 rounded-lg text-sm font-medium">Bassa</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="priority" value="medium" class="mr-2" checked>
                                    <span class="px-4 py-2 bg-blue-200 rounded-lg text-sm font-medium">Media</span>
                                </label>
                                <label class="flex items-center cursor-pointer">
                                    <input type="radio" name="priority" value="high" class="mr-2">
                                    <span class="px-4 py-2 bg-red-200 rounded-lg text-sm font-medium">Alta</span>
                                </label>
                            </div>
                        </div>

                        <!-- Description -->
                        <div class="md:col-span-2">
                            <label class="block text-sm font-medium text-gray-700 mb-2">
                                <i class="fas fa-align-left mr-1 text-purple-600"></i>Descrizione
                            </label>
                            <textarea name="goal_description" id="goal_description" rows="3" class="premium-input" placeholder="Descrivi il tuo obiettivo e come intendi raggiungerlo..."></textarea>
                        </div>
                    </div>

                    <div class="mt-6">
                        <button type="submit" class="premium-btn premium-btn-primary">
                            <i class="fas fa-plus mr-2"></i>Aggiungi Obiettivo
                        </button>
                    </div>
                </form>

                <!-- Active Goals List -->
                <div>
                    <h4 class="text-lg font-bold text-gray-800 mb-4">
                        <i class="fas fa-list mr-2 text-purple-600"></i>Obiettivi Attivi
                    </h4>
                    <div id="goalsList" class="space-y-4">
                        <!-- Sample Goal Card -->
                        <div class="p-6 bg-white border-2 border-gray-200 rounded-lg hover:border-purple-300 transition-all">
                            <div class="flex items-start justify-between mb-3">
                                <div class="flex-1">
                                    <div class="flex items-center gap-2 mb-2">
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">Peso</span>
                                        <span class="px-3 py-1 bg-yellow-100 text-yellow-700 rounded-full text-xs font-semibold">Media Priorità</span>
                                    </div>
                                    <h5 class="text-lg font-bold text-gray-800">Esempio: Raggiungere 80kg</h5>
                                    <p class="text-sm text-gray-600 mt-1">Descrizione obiettivo di esempio</p>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-purple-600">65%</div>
                                    <div class="text-xs text-gray-500">completato</div>
                                </div>
                            </div>

                            <!-- Progress Bar -->
                            <div class="mb-3">
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-gradient-to-r from-purple-600 to-blue-600 h-3 rounded-full" style="width: 65%"></div>
                                </div>
                            </div>

                            <div class="flex items-center justify-between text-sm">
                                <div class="flex items-center gap-4">
                                    <span class="text-gray-600">
                                        <i class="fas fa-tachometer-alt mr-1"></i>Attuale: <strong>77.5 kg</strong>
                                    </span>
                                    <span class="text-gray-600">
                                        <i class="fas fa-flag-checkered mr-1"></i>Target: <strong>80 kg</strong>
                                    </span>
                                    <span class="text-gray-600">
                                        <i class="fas fa-calendar mr-1"></i>Scadenza: <strong>30/06/2026</strong>
                                    </span>
                                </div>
                                <div class="flex gap-2">
                                    <button type="button" class="text-blue-600 hover:text-blue-700">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button type="button" class="text-red-600 hover:text-red-700">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Empty State (hidden when goals exist) -->
                        <div class="text-center py-12 text-gray-500 hidden" id="emptyGoalsState">
                            <i class="fas fa-bullseye text-6xl mb-4 block"></i>
                            <p class="text-lg font-medium">Nessun obiettivo attivo</p>
                            <p class="text-sm">Aggiungi il tuo primo obiettivo per iniziare a tracciare i progressi!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // Make functions globally accessible
    window.switchTab = function(tabName) {
        // Remove active class from all tabs and content
        document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
        document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

        // Add active class to selected tab and content
        document.getElementById('tab-' + tabName).classList.add('active');
        document.getElementById('content-' + tabName).classList.add('active');
    };

    window.previewAvatar = function(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function(e) {
                document.getElementById('avatarPreview').src = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }
    };

    window.uploadAvatar = function() {
        const form = document.getElementById('avatarForm');
        const formData = new FormData(form);

        if (!document.getElementById('avatarInput').files.length) {
            document.getElementById('avatarInput').click();
            return;
        }

        fetch('{{ url_for("athlete.upload_avatar") }}', {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Avatar aggiornato con successo!', 'success');
            } else {
                showNotification('Errore durante l\'aggiornamento dell\'avatar', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Errore durante l\'aggiornamento dell\'avatar', 'error');
        });
    };

    window.checkPasswordStrength = function() {
        const password = document.getElementById('newPassword').value;
        const strengthBar = document.getElementById('strengthBar');
        const strengthText = document.getElementById('strengthText');

        let strength = 0;
        if (password.length >= 8) strength++;
        if (password.match(/[a-z]/) && password.match(/[A-Z]/)) strength++;
        if (password.match(/[0-9]/)) strength++;
        if (password.match(/[^a-zA-Z0-9]/)) strength++;

        strengthBar.className = 'password-strength-bar';
        if (strength === 0 || password.length === 0) {
            strengthBar.style.width = '0';
            strengthText.textContent = 'Inserisci una password';
            strengthText.className = 'text-xs text-gray-500 mt-2';
        } else if (strength <= 2) {
            strengthBar.classList.add('strength-weak');
            strengthText.textContent = 'Password debole';
            strengthText.className = 'text-xs text-red-500 mt-2';
        } else if (strength === 3) {
            strengthBar.classList.add('strength-medium');
            strengthText.textContent = 'Password media';
            strengthText.className = 'text-xs text-yellow-500 mt-2';
        } else {
            strengthBar.classList.add('strength-strong');
            strengthText.textContent = 'Password forte';
            strengthText.className = 'text-xs text-green-500 mt-2';
        }
    };

    window.showNotification = function(message, type) {
        const notification = document.createElement('div');
        notification.className = `fixed top-4 right-4 px-6 py-4 rounded-lg shadow-lg text-white z-50 ${type === 'success' ? 'bg-green-500' : 'bg-red-500'}`;
        notification.innerHTML = `
            <div class="flex items-center gap-3">
                <i class="fas fa-${type === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                <span>${message}</span>
            </div>
        `;
        document.body.appendChild(notification);

        setTimeout(() => {
            notification.style.opacity = '0';
            notification.style.transition = 'opacity 0.3s ease';
            setTimeout(() => notification.remove(), 300);
        }, 3000);
    };

    // Handle form submissions
    document.getElementById('personalInfoForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch(this.action, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Informazioni aggiornate con successo!', 'success');
                setTimeout(() => switchTab('overview'), 1500);
            } else {
                showNotification(data.message || 'Errore durante l\'aggiornamento', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Errore durante l\'aggiornamento', 'error');
        });
    });

    document.getElementById('passwordForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        if (formData.get('new_password') !== formData.get('confirm_password')) {
            showNotification('Le password non corrispondono', 'error');
            return;
        }

        fetch(this.action, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Password aggiornata con successo!', 'success');
                this.reset();
                document.getElementById('strengthBar').style.width = '0';
                document.getElementById('strengthText').textContent = 'Inserisci una password';
            } else {
                showNotification(data.message || 'Errore durante l\'aggiornamento', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Errore durante l\'aggiornamento', 'error');
        });
    });

    document.getElementById('preferencesForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);

        fetch(this.action, {
            method: 'POST',
            body: formData
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                showNotification('Preferenze aggiornate con successo!', 'success');
                setTimeout(() => switchTab('overview'), 1500);
            } else {
                showNotification(data.message || 'Errore durante l\'aggiornamento', 'error');
            }
        })
        .catch(error => {
            console.error('Error:', error);
            showNotification('Errore durante l\'aggiornamento', 'error');
        });
    });

    // BMI Calculator for Measurements
    function calculateBMI() {
        const weight = parseFloat(document.getElementById('weight').value);
        const height = parseFloat(document.getElementById('height').value);

        if (weight && height) {
            const bmi = (weight / Math.pow(height / 100, 2)).toFixed(1);
            document.getElementById('bmi').value = bmi;
        } else {
            document.getElementById('bmi').value = '--';
        }
    }

    // Add event listeners for BMI calculation
    if (document.getElementById('weight')) {
        document.getElementById('weight').addEventListener('input', calculateBMI);
        document.getElementById('height').addEventListener('input', calculateBMI);
    }

    // Initialize Weight Trend Chart
    function initWeightTrendChart() {
        const ctx = document.getElementById('weightTrendChart');
        if (!ctx) return;

        // Sample data - replace with actual data from API
        const data = {
            labels: ['Gen', 'Feb', 'Mar', 'Apr', 'Mag', 'Giu'],
            datasets: [{
                label: 'Peso (kg)',
                data: [75, 74.5, 74, 73.5, 73.8, 73.5],
                borderColor: '#667eea',
                backgroundColor: 'rgba(102, 126, 234, 0.1)',
                tension: 0.4,
                fill: true,
                pointRadius: 4,
                pointHoverRadius: 6
            }]
        };

        new Chart(ctx, {
            type: 'line',
            data: data,
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        display: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: false,
                        grid: {
                            color: 'rgba(0, 0, 0, 0.05)'
                        }
                    },
                    x: {
                        grid: {
                            display: false
                        }
                    }
                }
            }
        });
    }

    // Initialize chart when measurements tab is clicked
    document.getElementById('tab-measurements')?.addEventListener('click', function() {
        setTimeout(initWeightTrendChart, 100);
    });

    // Measurements Form Submission
    if (document.getElementById('measurementsForm')) {
        document.getElementById('measurementsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch('/athlete/api/measurements', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Misurazione salvata con successo!', 'success');
                    this.reset();
                    document.getElementById('bmi').value = '--';
                    // Reload measurement history
                    loadMeasurementHistory();
                } else {
                    showNotification(data.message || 'Errore durante il salvataggio', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Errore durante il salvataggio', 'error');
            });
        });
    }

    // Load Measurement History
    function loadMeasurementHistory() {
        fetch('/athlete/api/measurements')
        .then(response => response.json())
        .then(data => {
            if (data.success && data.measurements.length > 0) {
                const tbody = document.getElementById('measurementHistory');
                tbody.innerHTML = '';

                data.measurements.forEach(m => {
                    const row = `
                        <tr class="border-t hover:bg-gray-50">
                            <td class="px-4 py-3">${m.date}</td>
                            <td class="px-4 py-3">${m.weight} kg</td>
                            <td class="px-4 py-3">${m.bmi}</td>
                            <td class="px-4 py-3">${m.body_fat}%</td>
                            <td class="px-4 py-3">
                                <button onclick="viewMeasurement(${m.id})" class="text-blue-600 hover:text-blue-700 mr-2">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button onclick="deleteMeasurement(${m.id})" class="text-red-600 hover:text-red-700">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            }
        })
        .catch(error => console.error('Error loading measurements:', error));
    }

    // Goals Form Submission
    if (document.getElementById('goalsForm')) {
        document.getElementById('goalsForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const formData = new FormData(this);

            fetch('/athlete/api/goals', {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Obiettivo aggiunto con successo!', 'success');
                    this.reset();
                    // Reload goals list
                    loadGoals();
                } else {
                    showNotification(data.message || 'Errore durante il salvataggio', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Errore durante il salvataggio', 'error');
            });
        });
    }

    // Load Goals
    function loadGoals() {
        fetch('/athlete/api/goals')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                // Update stats
                document.getElementById('completedGoals').textContent = data.stats.completed;
                document.getElementById('activeGoals').textContent = data.stats.active;
                document.getElementById('goalProgress').textContent = data.stats.progress + '%';

                // Update goals list
                const goalsList = document.getElementById('goalsList');
                if (data.goals.length > 0) {
                    goalsList.innerHTML = '';
                    data.goals.forEach(goal => {
                        const priorityClass = {
                            'low': 'bg-gray-100 text-gray-700',
                            'medium': 'bg-yellow-100 text-yellow-700',
                            'high': 'bg-red-100 text-red-700'
                        }[goal.priority] || 'bg-gray-100 text-gray-700';

                        const card = `
                            <div class="p-6 bg-white border-2 border-gray-200 rounded-lg hover:border-purple-300 transition-all">
                                <div class="flex items-start justify-between mb-3">
                                    <div class="flex-1">
                                        <div class="flex items-center gap-2 mb-2">
                                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-semibold">${goal.type}</span>
                                            <span class="px-3 py-1 ${priorityClass} rounded-full text-xs font-semibold">${goal.priority_label}</span>
                                        </div>
                                        <h5 class="text-lg font-bold text-gray-800">${goal.title}</h5>
                                        <p class="text-sm text-gray-600 mt-1">${goal.description || ''}</p>
                                    </div>
                                    <div class="text-right">
                                        <div class="text-2xl font-bold text-purple-600">${goal.progress}%</div>
                                        <div class="text-xs text-gray-500">completato</div>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <div class="w-full bg-gray-200 rounded-full h-3">
                                        <div class="bg-gradient-to-r from-purple-600 to-blue-600 h-3 rounded-full" style="width: ${goal.progress}%"></div>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-sm">
                                    <div class="flex items-center gap-4">
                                        <span class="text-gray-600">
                                            <i class="fas fa-tachometer-alt mr-1"></i>Attuale: <strong>${goal.current_value} ${goal.unit}</strong>
                                        </span>
                                        <span class="text-gray-600">
                                            <i class="fas fa-flag-checkered mr-1"></i>Target: <strong>${goal.target_value} ${goal.unit}</strong>
                                        </span>
                                        ${goal.target_date ? `<span class="text-gray-600">
                                            <i class="fas fa-calendar mr-1"></i>Scadenza: <strong>${goal.target_date}</strong>
                                        </span>` : ''}
                                    </div>
                                    <div class="flex gap-2">
                                        <button onclick="editGoal(${goal.id})" class="text-blue-600 hover:text-blue-700">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button onclick="deleteGoal(${goal.id})" class="text-red-600 hover:text-red-700">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                        goalsList.innerHTML += card;
                    });
                }
            }
        })
        .catch(error => console.error('Error loading goals:', error));
    }

    // Delete Goal
    window.deleteGoal = function(goalId) {
        if (confirm('Sei sicuro di voler eliminare questo obiettivo?')) {
            fetch(`/athlete/api/goals/${goalId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Obiettivo eliminato con successo!', 'success');
                    loadGoals();
                } else {
                    showNotification('Errore durante l\'eliminazione', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Errore durante l\'eliminazione', 'error');
            });
        }
    };

    // Delete Measurement
    window.deleteMeasurement = function(measurementId) {
        if (confirm('Sei sicuro di voler eliminare questa misurazione?')) {
            fetch(`/athlete/api/measurements/${measurementId}`, {
                method: 'DELETE'
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    showNotification('Misurazione eliminata con successo!', 'success');
                    loadMeasurementHistory();
                } else {
                    showNotification('Errore durante l\'eliminazione', 'error');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                showNotification('Errore durante l\'eliminazione', 'error');
            });
        }
    };

    // Set today's date as default for measurement date
    if (document.getElementById('measurement_date')) {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('measurement_date').value = today;
    }
</script>
{% endblock %}
